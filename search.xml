<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ELK学习笔记(一)</title>
      <link href="/2020/04/27/ELK%E6%90%AD%E5%BB%BA/"/>
      <url>/2020/04/27/ELK%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<hr><h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ol><li><p>Centos7</p></li><li><p>关闭Firewalld</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure><a id="more"></a></li><li><p>关闭Selinux</p></li></ol><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427165220.png" alt="selinux"></p><ol start="4"><li><p>192.168.208.137部署Kibana、ES</p></li><li><p>192.168.208.138部署Logstash</p></li></ol><p>JDK的二进制安装</p><ol><li><p>Jdk1.8二进制包下载路径<code>http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</code></p></li><li><p>解压到对应安装目录<code>/usr/local/</code></p></li></ol><p>安装命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line"></span><br><span class="line">tar -zxf jdk-8u201-linux-x64.tar.gz</span><br></pre></td></tr></table></figure><p>配置Java环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;jdk1.8.0_201&#x2F;</span><br><span class="line"></span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br><span class="line"></span><br><span class="line">export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;tools.jar:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$CLASSPATH</span><br></pre></td></tr></table></figure><p>使配置生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><p>验证环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p>验证环境变量</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427185318.png" alt="验证环境变量"></p><h2 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h2><ol><li><p>下载Kibana二进制包</p></li><li><p>解压到/usr/local完成安装</p></li></ol><p>Kibana安装脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local</span><br><span class="line"></span><br><span class="line">tar -zxf kibana-6.6.0-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><p>修改Kibana配置</p><p><code>/usr/local/kibana-6.6.0-linux-x86_64/config/kibana.yml</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port: 5601</span><br><span class="line"></span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line"></span><br><span class="line">#elasticsearch.url: &quot;http:&#x2F;&#x2F;localhost:9200&quot;</span><br><span class="line"></span><br><span class="line">#elasticsearch.username: &quot;user&quot;</span><br><span class="line"></span><br><span class="line">#elasticsearch.password: &quot;pass&quot;</span><br></pre></td></tr></table></figure><h3 id="Kibana的启动和访问"><a href="#Kibana的启动和访问" class="headerlink" title="Kibana的启动和访问"></a>Kibana的启动和访问</h3><ol><li><p>前台启动Kibana：/usr/local/kibana-6.6.0-linux-x86_64/bin/kibana</p></li><li><p>后台启动Kibana：nohup /usr/local/kibana-6.6.0-linux-x86_64/bin/kibana &gt;/tmp/kibana.log 2&gt;/tmp/kibana.log &amp;</p></li><li><p>访问Kibana，需要开放5601端口</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427190728.png" alt="访问"></p><p>看到这里就表示Kibana安装成功了</p></li></ol><h3 id="Kibana的安全说明"><a href="#Kibana的安全说明" class="headerlink" title="Kibana的安全说明"></a>Kibana的安全说明</h3><ol><li><p>默认无密码，也是谁都能够访问</p></li><li><p>如果使用云厂商，可以在安全组控制某个IP的访问</p></li><li><p>建议借用Nginx实现用户名密码登录</p></li></ol><p>Kibana借用Nginx实现认证</p><ol><li><p>Kibana监听在127.0.0.1</p></li><li><p>部署Nginx，使用Nginx来转发</p></li></ol><h3 id="Nginx编译安装"><a href="#Nginx编译安装" class="headerlink" title="Nginx编译安装"></a>Nginx编译安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y lrzsz wget gcc gcc-c++ make pcre pcre-devel zlib zlib-devel</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">wget &#39;http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.18.0.tar.gz&#39;</span><br><span class="line">tar -zxvf nginx-1.18.0.tar.gz</span><br><span class="line">cd nginx-1.18.0</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx-1.18.0 &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="Nginx环境变量设置"><a href="#Nginx环境变量设置" class="headerlink" title="Nginx环境变量设置"></a>Nginx环境变量设置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;nginx-1.18.0&#x2F;sbin&#x2F;</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><h3 id="Nginx限制源IP访问"><a href="#Nginx限制源IP访问" class="headerlink" title="Nginx限制源IP访问"></a>Nginx限制源IP访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;usr&#x2F;local&#x2F;nginx-1.18.0&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427200429.png" alt="Nginx限制源IP访问"></p><h3 id="查看访问日志"><a href="#查看访问日志" class="headerlink" title="查看访问日志"></a>查看访问日志</h3><ol><li><p>/usr/local/nginx-1.18.0/logs/access.log</p></li><li><p>如果被拒绝了可以在日志里找到源IP</p></li></ol><h3 id="修改Kibana配置"><a href="#修改Kibana配置" class="headerlink" title="修改Kibana配置"></a>修改Kibana配置</h3><p><code>/usr/local/kibana-6.6.0-linux-x86_64/config/kibana.yml</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427203136.png" alt="127.0.0.1"></p><h3 id="重启kibana"><a href="#重启kibana" class="headerlink" title="重启kibana"></a>重启kibana</h3><p><code>ps auxfww|grep kibana</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427203424.png" alt="重启kibana"></p><h3 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="Nginx使用用户名密码"><a href="#Nginx使用用户名密码" class="headerlink" title="Nginx使用用户名密码"></a>Nginx使用用户名密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;usr&#x2F;local&#x2F;nginx-1.18.0&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427204125.png" alt="密码文件"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch htpasswd</span><br><span class="line">printf &quot;username:$(openssl passwd -1 userpwd)\n&quot; &gt;&#x2F;usr&#x2F;local&#x2F;nginx-1.18.0&#x2F;conf&#x2F;htpasswd</span><br></pre></td></tr></table></figure><p>只需要修改username以及userpwd即可</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427201840.png" alt="用户名密码"></p><h3 id="重启nginx-1"><a href="#重启nginx-1" class="headerlink" title="重启nginx"></a>重启nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427202011.png" alt="访问"></p><h2 id="Elasticsearch部署"><a href="#Elasticsearch部署" class="headerlink" title="Elasticsearch部署"></a>Elasticsearch部署</h2><ol><li><p>解压到对应目录完成安装/usr/local/</p></li><li><p>Elasticsearch无法用root启动</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">tar -zxf elasticsearch-6.6.0.tar.gz</span><br></pre></td></tr></table></figure><h3 id="Elasticsearch配置"><a href="#Elasticsearch配置" class="headerlink" title="Elasticsearch配置"></a>Elasticsearch配置</h3><p><code>vi /usr/local/elasticsearch-6.6.0/config/elasticsearch.yml</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path.data: &#x2F;usr&#x2F;local&#x2F;elasticsearch-6.6.0&#x2F;data</span><br><span class="line"></span><br><span class="line">path.logs: &#x2F;usr&#x2F;local&#x2F;elasticsearch-6.6.0&#x2F;logs</span><br><span class="line"></span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"></span><br><span class="line">http.port: 9200</span><br></pre></td></tr></table></figure><p><strong>在生产环境中，一般是采用集群的方式搭建，不建议节点既有资格成为主节点还要存储数据，压力相当大</strong></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427213101.png" alt="目录"></p><h3 id="JVM调优"><a href="#JVM调优" class="headerlink" title="JVM调优"></a>JVM调优</h3><p><code>vi elasticsearch-6.6.0/config/jvm.options</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427205445.png" alt="jvm.options"></p><p> #默认为1g，建议修改为内存50%,不然容易出现OOM, 由于虚拟机环境配置较低采用128M</p><h3 id="Elasticsearch的启动"><a href="#Elasticsearch的启动" class="headerlink" title="Elasticsearch的启动"></a>Elasticsearch的启动</h3><p>需要普通用户启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd -s &#x2F;sbin&#x2F;nologin elk</span><br><span class="line">chown -R elk:elk &#x2F;usr&#x2F;local&#x2F;elasticsearch-6.6.0&#x2F;</span><br><span class="line">su - elk -s &#x2F;bin&#x2F;bash</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;elasticsearch-6.6.0&#x2F;bin&#x2F;elasticsearch -d</span><br></pre></td></tr></table></figure><h3 id="是否启动正常"><a href="#是否启动正常" class="headerlink" title="是否启动正常"></a>是否启动正常</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427210100.png" alt="启动正常"></p><h3 id="Elasticsearch注意事项"><a href="#Elasticsearch注意事项" class="headerlink" title="Elasticsearch注意事项"></a>Elasticsearch注意事项</h3><ol><li><p>Elasticsearch如果要跨机器通讯，需要监听在真实网卡上</p></li><li><p>监听在真实网卡需要调整系统参数才能正常启动</p></li></ol><h3 id="Elasticsearch监听在非127-0-0-1"><a href="#Elasticsearch监听在非127-0-0-1" class="headerlink" title="Elasticsearch监听在非127.0.0.1"></a>Elasticsearch监听在非127.0.0.1</h3><ol><li>监听在0.0.0.0或者内网地址</li></ol><p><code>vi /usr/local/elasticsearch-6.6.0/config/elasticsearch.yml</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427210642.png" alt="修改"></p><h3 id="最大文件打开数"><a href="#最大文件打开数" class="headerlink" title="最大文件打开数"></a>最大文件打开数</h3><p>root 权限下</p><p><code>vi /etc/security/limits.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* - nofile 65536</span><br></pre></td></tr></table></figure><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427211554.png" alt="最大文件打开数"></p><h4 id="重启Elasticsearch"><a href="#重启Elasticsearch" class="headerlink" title="重启Elasticsearch"></a>重启Elasticsearch</h4><p><code>ps auxfww</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/image-20200427210922011.png" alt="杀掉进程"></p><p><code>/usr/local/elasticsearch-6.6.0/bin/elasticsearch -d</code></p><h3 id="最大打开进程数"><a href="#最大打开进程数" class="headerlink" title="最大打开进程数"></a>最大打开进程数</h3><p>root权限</p><p><code>vi /etc/security/limits.d/20-nproc.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* - nproc 4096</span><br></pre></td></tr></table></figure><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427212416.png" alt="4096"></p><h3 id="内核参数"><a href="#内核参数" class="headerlink" title="内核参数"></a>内核参数</h3><p><code>vi /etc/sysctl.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count &#x3D; 262144</span><br></pre></td></tr></table></figure><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427212712.png" alt="内核参数"></p><p><code>sysctl -p</code></p><p>修改完大退重新登陆</p><p>切换到elk账户</p><p><code>su - elk -s /bin/bash</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;elasticsearch-6.6.0&#x2F;bin&#x2F;elasticsearch -d</span><br></pre></td></tr></table></figure><h3 id="Elasticsearch监听网卡"><a href="#Elasticsearch监听网卡" class="headerlink" title="Elasticsearch监听网卡"></a>Elasticsearch监听网卡</h3><ol><li><p>模拟环境，建议监听在127.0.0.1</p></li><li><p>云服务器，9200和9300公网入口限制安全组</p></li><li><p>自建机房，监听在内网网卡，监听在公网容易被入侵</p></li></ol><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427213628.png" alt="访问9200"></p><h2 id="Elasticsearch操作"><a href="#Elasticsearch操作" class="headerlink" title="Elasticsearch操作"></a>Elasticsearch操作</h2><p>###Elasticsearch的概念</p><ol><li><p>索引 -&gt;类似于Mysql中的数据库</p></li><li><p>类型 -&gt;类似于Mysql中的数据表</p></li><li><p>文档 -&gt;存储数据</p></li></ol><h3 id="Elasticsearch数据操作"><a href="#Elasticsearch数据操作" class="headerlink" title="Elasticsearch数据操作"></a>Elasticsearch数据操作</h3><ol><li>curl操作Elasticsearch</li></ol><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427213956.png" alt="curl操作"></p><ol start="2"><li>Kibana操作Elasticsearch</li></ol><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427214250.png" alt="kibana操作"></p><h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><p><code>PUT /na1r</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427214430.png" alt="创建索引"></p><h4 id="获取全部索引"><a href="#获取全部索引" class="headerlink" title="获取全部索引"></a>获取全部索引</h4><p><code>GET /_cat/indices?v</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427214747.png" alt="全部索引"></p><h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><p><code>DELETE /na1r</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427214926.png" alt="删除索引"></p><h3 id="Elasticsearch增删改查"><a href="#Elasticsearch增删改查" class="headerlink" title="Elasticsearch增删改查"></a>Elasticsearch增删改查</h3><h4 id="增"><a href="#增" class="headerlink" title="增"></a>增</h4><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427215356.png" alt="插入数据"></p><h4 id="查"><a href="#查" class="headerlink" title="查"></a>查</h4><p><code>GET /na1r/users/1</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427215555.png" alt="查1"></p><p><code>GET /na1r/_search?q=*</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427215726.png" alt="查2"></p><h4 id="改，覆盖"><a href="#改，覆盖" class="headerlink" title="改，覆盖"></a>改，覆盖</h4><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427215915.png" alt="覆盖"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427220055.png" alt="改2"></p><h4 id="删"><a href="#删" class="headerlink" title="删"></a>删</h4><p><code>DELETE /na1r/users/1</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427220150.png" alt="删1"></p><h4 id="修改某个字段"><a href="#修改某个字段" class="headerlink" title="修改某个字段"></a>修改某个字段</h4><p>不覆盖</p><p>使用<code>doc</code>标注修改的内容</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427220644.png" alt="修改doc"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427220723.png" alt="更改结果"></p><h4 id="修改所有"><a href="#修改所有" class="headerlink" title="修改所有"></a>修改所有</h4><p>修改前</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427220959.png" alt="修改前"></p><p>修改后</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427221406.png" alt="1"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427221438.png" alt="修改后"></p><h4 id="增加字段"><a href="#增加字段" class="headerlink" title="增加字段"></a>增加字段</h4><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427221611.png" alt="增加"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200427221640.png" alt="增加后"></p><h2 id="Logstash部署"><a href="#Logstash部署" class="headerlink" title="Logstash部署"></a>Logstash部署</h2><h3 id="Logstash安装"><a href="#Logstash安装" class="headerlink" title="Logstash安装"></a>Logstash安装</h3><p>192.168.208.138部署Logstash</p><p>需要Java环境</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">tar -zxf logstash-6.6.0.tar.gz</span><br></pre></td></tr></table></figure><h3 id="JVM配置文件"><a href="#JVM配置文件" class="headerlink" title="JVM配置文件"></a>JVM配置文件</h3><p>由于模拟环境配置较低</p><p><code>vi /usr/local/logstash-6.6.0/config/jvm.options</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428180805.png" alt="jvm配置"></p><h3 id="logstash详情"><a href="#logstash详情" class="headerlink" title="logstash详情"></a>logstash详情</h3><p>Logstash的功能分为接收数据、解析过滤并转换数据、输出数据三个部分，</p><p>对应的插件依次是input插件、filter插件、output插件，其中，filter插件是可选的</p><h3 id="常用的"><a href="#常用的" class="headerlink" title="常用的"></a>常用的</h3><p><strong>input</strong></p><ul><li><p>-file：读取一个文件，这个读取功能有点类似于Linux的tail命令，一行一行的实时读取</p></li><li><p>-syslog：监听系统514端口的syslog messages，并使用RFC3164格式进行解析</p></li><li><p>-redis：Logstash可以从redis服务器读取数据，redis类似一个消息缓存组件</p></li><li><p>-kafka：从kafka服务器读取数据，与logstash架构配合使用一般用在数据量较大的场景。kafka可作数据的缓冲和存储</p></li><li><p>-filebeat：文本日志收集器，logstash可以接收filebeat发送过来的数据。</p></li></ul><p><strong>filter</strong></p><p>filter插件用于数据的过滤、解析和格式化，也就是将非结构化的数据解析成结构化的、可查询的标准化数据。常见filter插件如下：</p><ul><li><p>-grok：grok是logstash最重要的插件，可解析并结构化任意数据，支持正则，并提供了很多内置的规则和模板可供使用。</p></li><li><p>-mutate：此插件提供了丰富的基础类型数据处理能力。包括类型转换、字符串处理和字段处理</p></li><li><p>-date：用来转换日志记录中的时间字符串</p></li><li><p>-GeoIP：此插件可以根据ip地址提供对应的地域信息，包括国别，省市，经纬度等，对于可视化地图和区域统计非常有用</p></li></ul><p><strong>output</strong></p><p>output插件用于数据的输出，一个logstash事件可以穿过多个output，直到所有的output处理完毕，这个事件才结束。输出插件常见的如下：</p><ul><li><p>-elasticsearch：发送数据到elasticsearch</p></li><li><p>-file：发送数据到文件</p></li><li><p>-redis：发送数据到redis中。redis插件可在input和output插件中</p></li><li><p>-kafka：发送数据到kafka中</p></li></ul><h3 id="Logstash简单的配置"><a href="#Logstash简单的配置" class="headerlink" title="Logstash简单的配置"></a>Logstash简单的配置</h3><p><code>vi /usr/local/logstash-6.6.0/config/logstash.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">  stdin&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line">  stdout&#123;</span><br><span class="line">    codec&#x3D;&gt;rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Logstash启动</p><p><strong>优化启动速度</strong></p><p><code>yum install haveged -y</code></p><p><code>systemctl enable haveged</code></p><p><code>systemctl start haveged</code></p><p><strong>前台启动</strong></p><p><code>/usr/local/logstash-6.6.0/bin/logstash -f /usr/local/logstash-6.6.0/config/logstash.conf</code></p><p><strong>后台启动</strong></p><p><code>nohup /usr/local/logstash-6.6.0/bin/logstash -f /usr/local/logstash-6.6.0/config/logstash.conf &gt;/tmp/logstash.log 2&gt;/tmp/logstash.log &amp;</code></p><p>启动后测试一下</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428182142.png" alt="测试"></p><p>输入：na1r</p><p>输出：</p><p>{<br>       “message” =&gt; “na1r”,<br>    “@timestamp” =&gt; 2020-04-28T10:20:47.091Z,<br>      “@version” =&gt; “1”,<br>          “host” =&gt; “localhost.localdomain”<br>}</p><p>Logstash读取日志</p><p>读取登录日志看看</p><p><code>tail -f /var/log/secure</code></p><p><code>vi /usr/local/logstash-6.6.0/config/logstash.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">    path &#x3D;&gt; &quot;&#x2F;var&#x2F;log&#x2F;secure&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line">  stdout&#123;</span><br><span class="line">    codec&#x3D;&gt;rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动</p><p><code>/usr/local/logstash-6.6.0/bin/logstash -f /usr/local/logstash-6.6.0/config/logstash.conf</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428182857.png" alt="输出日志"></p><h3 id="Logstash读取日志发送到ES"><a href="#Logstash读取日志发送到ES" class="headerlink" title="Logstash读取日志发送到ES"></a>Logstash读取日志发送到ES</h3><p>用nginx日志试一下</p><p>本机安装nginx</p><h4 id="Nginx编译安装-1"><a href="#Nginx编译安装-1" class="headerlink" title="Nginx编译安装"></a>Nginx编译安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y lrzsz wget gcc gcc-c++ make pcre pcre-devel zlib zlib-devel</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">wget &#39;http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.18.0.tar.gz&#39;</span><br><span class="line">tar -zxvf nginx-1.18.0.tar.gz</span><br><span class="line">cd nginx-1.18.0</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx-1.18.0 &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="Nginx环境变量设置-1"><a href="#Nginx环境变量设置-1" class="headerlink" title="Nginx环境变量设置"></a>Nginx环境变量设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;nginx-1.18.0&#x2F;sbin&#x2F;</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><p><code>vi /usr/local/nginx-1.18.0/conf/nginx.conf</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428184421.png" alt="去掉注释"></p><h3 id="开启nginx"><a href="#开启nginx" class="headerlink" title="开启nginx"></a>开启nginx</h3><p><strong>注：开启nginx可能会出现报错</strong></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428184906.png" alt="报错"></p><p>touch相应的文件然后</p><p><code>nginx -t</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428185027.png" alt="nginx -t"></p><p><code>/usr/local/nginx-1.18.0/sbin/nginx -c /usr/local/nginx-1.18.0/conf/nginx.conf</code></p><p><strong>启动</strong></p><p><code>nginx -s reload</code></p><p><strong>访问</strong></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428184810.png" alt="访问"></p><p><strong>telnet</strong></p><p>看看es是不是通的，下图就表示通的。</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428185332.png" alt="通的"></p><h4 id="修改logstash-conf"><a href="#修改logstash-conf" class="headerlink" title="修改logstash.conf"></a>修改logstash.conf</h4><p><code>vi /usr/local/logstash-6.6.0/config/logstash.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">    path &#x3D;&gt; &quot;&#x2F;usr&#x2F;local&#x2F;nginx-1.18.0&#x2F;logs&#x2F;access.log&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts &#x3D;&gt; [&quot;http:&#x2F;&#x2F;192.168.208.137:9200&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428185527.png" alt="配置2"></p><h4 id="启动logstash"><a href="#启动logstash" class="headerlink" title="启动logstash"></a>启动logstash</h4><p><code>/usr/local/logstash-6.6.0/bin/logstash -f /usr/local/logstash-6.6.0/config/logstash.conf</code></p><h4 id="看一下nginx日志"><a href="#看一下nginx日志" class="headerlink" title="看一下nginx日志"></a>看一下nginx日志</h4><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428185827.png" alt="nginx日志"></p><h4 id="访问ES"><a href="#访问ES" class="headerlink" title="访问ES"></a>访问ES</h4><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428190250.png" alt="访问ES"></p><h4 id="Logstash收集日志"><a href="#Logstash收集日志" class="headerlink" title="Logstash收集日志"></a>Logstash收集日志</h4><ol><li><p>日志文件需要有新日志产生</p></li><li><p>Logstash跟Elasticsearch要能通讯</p></li></ol><h2 id="Kibana查询数据"><a href="#Kibana查询数据" class="headerlink" title="Kibana查询数据"></a>Kibana查询数据</h2><p><code>GET /logstash-xx/_search?q=*</code></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428190547.png" alt="查询"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428190627.png" alt="数据"></p><p><strong>创建索引查看日志</strong></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428190953.png" alt="创建索引查看日志"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428191103.png" alt="选中时间戳"></p><p><strong>创建完成后点击Discover</strong></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428191237.png" alt="Discover"></p><p>日志就比较直观的显示出来了</p><p><strong>选择自动刷新时间</strong></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428191437.png" alt=""></p><p>可以访问nginx多造一些日志看看</p><h3 id="Kibana简单查询"><a href="#Kibana简单查询" class="headerlink" title="Kibana简单查询"></a>Kibana简单查询</h3><ol><li><p>根据字段查询：message: “_msearch”</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428191758.png" alt="message"></p></li><li><p>根据字段查询：选中查询</p></li></ol><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/20200428191919.png" alt="针对查询"></p><p><strong>elk基本入门笔记，后续针对正则表达式学习笔记再整理一下，还有Filebeat以及Redis等</strong></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elk </tag>
            
            <tag> 日志分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C语言总结小项目-图书管理系统</title>
      <link href="/2020/04/06/C%E8%AF%AD%E8%A8%80%E6%80%BB%E7%BB%93%E5%B0%8F%E9%A1%B9%E7%9B%AE-%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
      <url>/2020/04/06/C%E8%AF%AD%E8%A8%80%E6%80%BB%E7%BB%93%E5%B0%8F%E9%A1%B9%E7%9B%AE-%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>学习软件逆向的第一步，用一个小程序总结一下。</p><a id="more"></a><h2 id="main-h"><a href="#main-h" class="headerlink" title="main.h"></a>main.h</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct Node</span><br><span class="line">&#123;</span><br><span class="line">char BookName[50];&#x2F;&#x2F;书名</span><br><span class="line">float BookPrice;&#x2F;&#x2F;价格</span><br><span class="line">int BookNumber;&#x2F;&#x2F;书号</span><br><span class="line">struct Node *next;&#x2F;&#x2F;指向下一个节点的指针</span><br><span class="line">&#125;Node;</span><br><span class="line">&#x2F;&#x2F;添加</span><br><span class="line">Node * AppendNode(Node * head, char * BookName, float BookPrice, int BookNumber);</span><br><span class="line">&#x2F;&#x2F;按书名查询</span><br><span class="line">void QueryNode(Node * head, char * BookName);</span><br><span class="line">&#x2F;&#x2F;按书号查找</span><br><span class="line">void QueryNode2(Node * head, int BookNumber);</span><br><span class="line">&#x2F;&#x2F;修改</span><br><span class="line">void ModifyNode(Node * head, char * BookName, float BookPrice);</span><br><span class="line">&#x2F;&#x2F;删除</span><br><span class="line">Node * DeleteNode(Node * head, char * BookName);</span><br><span class="line">&#x2F;&#x2F;查看全部</span><br><span class="line">void AllNode(Node * head);</span><br></pre></td></tr></table></figure><h2 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;main.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;------图书管理系统------\n&quot;);</span><br><span class="line">Node * head &#x3D; NULL;&#x2F;&#x2F;链表头指针</span><br><span class="line">while (1)</span><br><span class="line">&#123;</span><br><span class="line">char szBookName[50];</span><br><span class="line">float fBookPrice;</span><br><span class="line">float fNewBookPrice;</span><br><span class="line">int nBookNumber;</span><br><span class="line">int Readflag &#x3D; 0;</span><br><span class="line">int Queryflag &#x3D; 0;</span><br><span class="line">printf(&quot;      1.添加书籍\n&quot;);</span><br><span class="line">printf(&quot;      2.查询书籍\n&quot;);</span><br><span class="line">printf(&quot;      3.修改书籍\n&quot;);</span><br><span class="line">printf(&quot;      4.删除书籍\n&quot;);</span><br><span class="line">printf(&quot;      5.查看全部\n&quot;);</span><br><span class="line">printf(&quot;      6.退出系统\n&quot;);</span><br><span class="line">printf(&quot;请选择您要使用的功能：\n&quot;);</span><br><span class="line">scanf(&quot;%d&quot;, &amp;Readflag);</span><br><span class="line"></span><br><span class="line">switch (Readflag)</span><br><span class="line">&#123;</span><br><span class="line">case 1:</span><br><span class="line">&#x2F;&#x2F;添加书籍信息</span><br><span class="line"></span><br><span class="line">printf(&quot;请输入书名：\n&quot;);</span><br><span class="line">scanf(&quot;%s&quot;, szBookName);</span><br><span class="line">printf(&quot;请输入定价：\n&quot;);</span><br><span class="line">scanf(&quot;%f&quot;, &amp;fBookPrice);</span><br><span class="line">printf(&quot;请输入书号：\n&quot;);</span><br><span class="line">scanf(&quot;%d&quot;, &amp;nBookNumber);</span><br><span class="line">printf(&quot;添加成功！\n&quot;);</span><br><span class="line">head &#x3D; AppendNode(head, szBookName, fBookPrice, nBookNumber);</span><br><span class="line">break;</span><br><span class="line">case 2:</span><br><span class="line">printf(&quot;请选择查找方式：\n&quot;);</span><br><span class="line">printf(&quot;     1.按书名查找\n&quot;);</span><br><span class="line">printf(&quot;     2.按书号查找\n&quot;);</span><br><span class="line">printf(&quot;请选择需要使用的功能：&quot;);</span><br><span class="line">scanf(&quot;%d&quot;, &amp;Queryflag);</span><br><span class="line">if (Queryflag &#x3D;&#x3D; 1)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;请输入书名：\n&quot;);</span><br><span class="line">scanf(&quot;%s&quot;, szBookName);</span><br><span class="line">QueryNode(head, szBookName);</span><br><span class="line">&#125;</span><br><span class="line">else if (Queryflag &#x3D;&#x3D; 2)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;请输入书号：\n&quot;);</span><br><span class="line">scanf(&quot;%d&quot;, &amp;nBookNumber);</span><br><span class="line">QueryNode2(head, nBookNumber);</span><br><span class="line">&#125;</span><br><span class="line">break;</span><br><span class="line">case 3:</span><br><span class="line">printf(&quot;请输入书名：\n&quot;);</span><br><span class="line">scanf(&quot;%s&quot;, szBookName);</span><br><span class="line">printf(&quot;请输入新的定价：&quot;);</span><br><span class="line">scanf(&quot;%f&quot;,&amp;fNewBookPrice);</span><br><span class="line">ModifyNode(head, szBookName, fNewBookPrice);</span><br><span class="line">break;</span><br><span class="line">case 4:</span><br><span class="line">printf(&quot;请输入书名：\n&quot;);</span><br><span class="line">scanf(&quot;%s&quot;, szBookName);</span><br><span class="line">printf(&quot;删除成功！\n&quot;);</span><br><span class="line">head &#x3D; DeleteNode(head, szBookName);</span><br><span class="line">break;</span><br><span class="line">case 5:</span><br><span class="line">AllNode(head);</span><br><span class="line">break;</span><br><span class="line">case 6:</span><br><span class="line">exit(0);</span><br><span class="line">default:</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;增</span><br><span class="line">Node * AppendNode(Node * head, char * BookName, float BookPrice, int BookNumber)</span><br><span class="line">&#123;</span><br><span class="line">&#x2F;&#x2F;声明一个新的节点</span><br><span class="line">Node * pNewNode &#x3D; NULL;</span><br><span class="line">&#x2F;&#x2F;声明一个指向头指针的指针</span><br><span class="line">Node * pHeadNode &#x3D; head;</span><br><span class="line">&#x2F;&#x2F;申请一个内存</span><br><span class="line">pNewNode &#x3D; (Node *)malloc(sizeof(Node));</span><br><span class="line">&#x2F;&#x2F;判断内存有没有申请成功</span><br><span class="line">if (pNewNode &#x3D;&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">printf(&quot;memory malloc failed!\n&quot;);</span><br><span class="line">exit(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (head &#x3D;&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">&#x2F;&#x2F;如果没有头节点，就把头指针指向新申请的内存</span><br><span class="line">head &#x3D; pNewNode;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">&#x2F;&#x2F;判断有没有到链表结尾</span><br><span class="line">while (pHeadNode-&gt;next !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">pHeadNode &#x3D; pHeadNode-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;如果指向最后一个节点就重新指向到新的最后一个节点</span><br><span class="line">pHeadNode-&gt;next &#x3D; pNewNode;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;书名</span><br><span class="line">strcpy(pNewNode-&gt;BookName, BookName);</span><br><span class="line">&#x2F;&#x2F;定价</span><br><span class="line">pNewNode-&gt;BookPrice &#x3D; BookPrice;</span><br><span class="line">&#x2F;&#x2F;书号</span><br><span class="line">pNewNode-&gt;BookNumber &#x3D; BookNumber;</span><br><span class="line">&#x2F;&#x2F;把最后一个节点指向NULL</span><br><span class="line">pNewNode-&gt;next &#x3D; NULL;</span><br><span class="line">return head;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;查找</span><br><span class="line">void QueryNode(Node * head, char * BookName)</span><br><span class="line">&#123;</span><br><span class="line">int flag &#x3D; 0;</span><br><span class="line">if (head &#x3D;&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;head NULL!\n&quot;);</span><br><span class="line">exit(0);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;判断信息是否一致</span><br><span class="line">if (strcmp(BookName,head-&gt;BookName) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;书价\t书名\t书号\n&quot;);</span><br><span class="line">printf(&quot;%0.2f\t%s\t%d\n&quot;, head-&gt;BookPrice, head-&gt;BookName, head-&gt;BookNumber);</span><br><span class="line">flag &#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;如果不是空</span><br><span class="line">while (head-&gt;next !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">head &#x3D; head-&gt;next;</span><br><span class="line">if (strcmp(BookName, head-&gt;BookName) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;书价\t书名\t书号\n&quot;);</span><br><span class="line">printf(&quot;%0.2f\t%s\t%d\n&quot;, head-&gt;BookPrice, head-&gt;BookName, head-&gt;BookNumber);</span><br><span class="line">flag &#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (flag &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;查询失败!!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;按书号查找</span><br><span class="line">void QueryNode2(Node * head, int BookNumber)</span><br><span class="line">&#123;</span><br><span class="line">int flag &#x3D; 0;</span><br><span class="line">if (head &#x3D;&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;head NULL!\n&quot;);</span><br><span class="line">exit(0);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;判断信息是否一致</span><br><span class="line">if (BookNumber &#x3D;&#x3D; head-&gt;BookNumber)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;书价\t书名\t书号\n&quot;);</span><br><span class="line">printf(&quot;%0.2f\t%s\t%d\n&quot;, head-&gt;BookPrice, head-&gt;BookName, head-&gt;BookNumber);</span><br><span class="line">flag &#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;如果不是空</span><br><span class="line">while (head-&gt;next !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">head &#x3D; head-&gt;next;</span><br><span class="line">if (BookNumber &#x3D;&#x3D; head-&gt;BookNumber)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;书价\t书名\t书号\n&quot;);</span><br><span class="line">printf(&quot;%0.2f\t%s\t%d\n&quot;, head-&gt;BookPrice, head-&gt;BookName, head-&gt;BookNumber);</span><br><span class="line">flag &#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (flag &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;查询失败!!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;修改</span><br><span class="line">void ModifyNode(Node * head, char * BookName, float BookPrice)</span><br><span class="line">&#123;</span><br><span class="line">int flag &#x3D; 0;</span><br><span class="line">float OldPrice;&#x2F;&#x2F;历史价格</span><br><span class="line">if (head &#x3D;&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;head NULL!\n&quot;);</span><br><span class="line">exit(0);</span><br><span class="line">&#125;</span><br><span class="line">if (strcmp(BookName, head-&gt;BookName) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">OldPrice &#x3D; head-&gt;BookPrice;&#x2F;&#x2F;历史价格</span><br><span class="line">head-&gt;BookPrice &#x3D; BookPrice;</span><br><span class="line">printf(&quot;成功修改价格!\n&quot;);</span><br><span class="line">printf(&quot;书号\t书名\t新书价\t历史价格\n&quot;);</span><br><span class="line">printf(&quot;%d\t%s\t%0.2f\t%0.2f\n&quot;, head-&gt;BookNumber, head-&gt;BookName, head-&gt;BookPrice,OldPrice);</span><br><span class="line">flag &#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line">while (head-&gt;next !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">head &#x3D; head-&gt;next;</span><br><span class="line">if (strcmp(BookName, head-&gt;BookName) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">OldPrice &#x3D; head-&gt;BookPrice;&#x2F;&#x2F;历史价格</span><br><span class="line">head-&gt;BookPrice &#x3D; BookPrice;</span><br><span class="line">printf(&quot;书号\t书名\t新书价\t历史价格\n&quot;);</span><br><span class="line">printf(&quot;%d\t%s\t%0.2f\t%0.2f\n&quot;, head-&gt;BookNumber, head-&gt;BookName, head-&gt;BookPrice, OldPrice);</span><br><span class="line">flag &#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if (flag &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;查询失败!!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;删除</span><br><span class="line">Node * DeleteNode(Node * head, char * BookName)</span><br><span class="line">&#123;</span><br><span class="line">Node * pNode &#x3D; NULL;</span><br><span class="line">if (head &#x3D;&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;head NULL!\n&quot;);</span><br><span class="line">exit(0);</span><br><span class="line">&#125;</span><br><span class="line">if (strcmp(BookName, head-&gt;BookName) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">if (head -&gt;next !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">pNode &#x3D; head-&gt;next;</span><br><span class="line">free(head);</span><br><span class="line">return pNode;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;List null!\n&quot;);</span><br><span class="line">return NULL;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if (strcmp(BookName, head-&gt;next-&gt;BookName) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">if (head -&gt;next -&gt;next-&gt;BookName !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">pNode &#x3D; head-&gt;next-&gt;next;</span><br><span class="line">head-&gt;next &#x3D; pNode;</span><br><span class="line">return head;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">while (head-&gt;next-&gt;next !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">if (strcmp(BookName, head-&gt;next-&gt;next-&gt;BookName) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">pNode &#x3D; head-&gt;next-&gt;next-&gt;next;</span><br><span class="line">head-&gt;next-&gt;next &#x3D; pNode;</span><br><span class="line">return head;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;查看全部</span><br><span class="line">void AllNode(Node * head)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;书号\t书名\t定价\n&quot;);</span><br><span class="line">while (head !&#x3D; NULL)</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;%d\t%s\t%0.2f\n&quot;, head-&gt;BookNumber, head-&gt;BookName, head-&gt;BookPrice);</span><br><span class="line">head &#x3D; head-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
            <tag> 图书 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark流量检测学习</title>
      <link href="/2020/03/30/Wireshark%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/03/30/Wireshark%E6%B5%81%E9%87%8F%E6%A3%80%E6%B5%8B%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="Wireshark入门简介"><a href="#Wireshark入门简介" class="headerlink" title="Wireshark入门简介"></a>Wireshark入门简介</h2><p>Wireshark（前称Ethereal）是一个网络封包分析软件。网络封包分析软件的功能是撷取网络封包，并尽可能显示出最为详细的网络封包资料。</p><a id="more"></a><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/1.png" alt="1"></p><h3 id="软件的功能"><a href="#软件的功能" class="headerlink" title="软件的功能"></a>软件的功能</h3><ul><li>解决网络故障问题</li><li>溯源网络流量</li><li>分析网络底层协议</li></ul><h3 id="相关软件"><a href="#相关软件" class="headerlink" title="相关软件"></a>相关软件</h3><ul><li>科来网络分析系统</li><li>Httpwatch</li><li>Fiddler</li><li>Sniffer</li></ul><h3 id="支持平台"><a href="#支持平台" class="headerlink" title="支持平台"></a>支持平台</h3><ul><li>Windows</li><li>Linux</li><li>MacOS</li></ul><h2 id="Wireshark底层框架"><a href="#Wireshark底层框架" class="headerlink" title="Wireshark底层框架"></a>Wireshark底层框架</h2><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/2.png" alt="2"></p><p>GTK1/2：图形处理工具，处理用户的输入输出。</p><p>Core：核心引擎，通过函数调用将其他模块连接在一起，起到联动调用的作用。</p><p>Wiretap：此时获取的是一些比特流，通过Wiretap（格式支持引擎）能从抓包文件中读取数据包，支持多种文件格式。</p><p>Capture：抓包引擎，利用libpcap/WinPcap底层抓取网络数据包，libpcap/WinPcap提供了通用的抓包接口，能从不同类型的网络接口（包括以太网、令牌环网、ATM网等）获取数据包。</p><p>Win-/libpcap：Wireshark抓包时依赖的库文件。</p><h2 id="Wireshark抓包原理"><a href="#Wireshark抓包原理" class="headerlink" title="Wireshark抓包原理"></a>Wireshark抓包原理</h2><ul><li><p>本地环境</p><ul><li><p>最基本的抓包方式，不借助其他第三方设备，抓取本地网卡进出网络流量，针对自己网卡不能针对整个局域网</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/3.png" alt="3"></p></li></ul></li><li><p>集线器环境</p><ul><li>同一域，集线器是网络层设备，不学习数据包，广播所有接口（已经很少有这种环境）</li></ul></li><li><p>交换机环境</p><ul><li><p>镜像端口，将数据拷贝一份到一个端口，交换机端口做SAPN端口镜像操作</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/4.png" alt="4"></p></li><li><p>ARP欺骗, 假设没有权限在交换机上做端口镜像技术，因为有MAC地址表，又想获取整个局域网中的流量，窃取到其他PC上的流量。这可以通过著名的ARP攻击软件Cain&amp;Abel实现</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/5.png" alt="5"></p></li><li><p>MAC泛洪</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/6.png" alt="6"></p></li></ul></li></ul><h2 id="Wireshark下载"><a href="#Wireshark下载" class="headerlink" title="Wireshark下载"></a>Wireshark下载</h2><p>下载地址：<a href="https://www.wireshark.org/" target="_blank" rel="noopener">https://www.wireshark.org/</a></p><h2 id="Wireshark-调试功能"><a href="#Wireshark-调试功能" class="headerlink" title="Wireshark 调试功能"></a>Wireshark 调试功能</h2><h3 id="界面设置"><a href="#界面设置" class="headerlink" title="界面设置"></a>界面设置</h3><p>Wireshark运行后，界面如下图所示，包括标题栏、菜单栏、工具栏、数据包过滤栏、数据包列表区、数据包详细区、数据包字节区、数据包统计区。</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/7.png" alt="7"></p><p>点击“捕获”-&gt;“选项”如下图所示，设置输入接口和过滤器。</p><p>数据包详细区是解析数据包核心区域。数据包包含时间流、原始IP地址和目的IP地址、协议、长度、内容等，当双击它能看到对应的详细信息。</p><h3 id="列设置"><a href="#列设置" class="headerlink" title="列设置"></a>列设置</h3><p>列设置包括默认列表、增加列、修改列、隐藏列、删除列，设置默认即可，下图是选中某行右键“应用为列”增加列。</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/9.png" alt="8"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/10.png" alt="10"></p><h3 id="时间设置"><a href="#时间设置" class="headerlink" title="时间设置"></a>时间设置</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/11.png" alt="11"></p><p>也可以右键Time列</p><h3 id="数据包合并导出"><a href="#数据包合并导出" class="headerlink" title="数据包合并导出"></a>数据包合并导出</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/13.png" alt="13"></p><h3 id="抓包过滤器"><a href="#抓包过滤器" class="headerlink" title="抓包过滤器"></a>抓包过滤器</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/14.png" alt="14"></p><ul><li>类型（Type）<ul><li>host、net、port</li></ul></li><li>方向（Dir）<ul><li>src、dst</li></ul></li><li>协议（Proto）<ul><li>ether、ip、tcp、udp、http、ftp</li></ul></li><li>逻辑运算符<ul><li><code>&amp;&amp;</code> 与</li><li><code>||</code> 或</li><li><code>!</code> 非</li></ul></li></ul><h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><p>抓取源地址为192.168.1.101，目的端口为80的流量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src host 192.168.1.101 &amp;&amp; dst port 80</span><br></pre></td></tr></table></figure><p>抓取192.168.1.101和192.168.1.102的流量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host 192.168.1.101 || host 192.168.1.102</span><br></pre></td></tr></table></figure><p>不抓取广播包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! broadcast</span><br></pre></td></tr></table></figure><p>过滤IP地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host 192.168.1.101</span><br><span class="line">src host 192.168.1.101</span><br><span class="line">dst host 192.168.1.101</span><br></pre></td></tr></table></figure><p>过滤端口：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">port 80</span><br><span class="line">!port 80</span><br><span class="line">dst port 80</span><br><span class="line">src port 80</span><br></pre></td></tr></table></figure><h3 id="显示过滤器"><a href="#显示过滤器" class="headerlink" title="显示过滤器"></a>显示过滤器</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/15.png" alt="15">))</p><h4 id="比较符："><a href="#比较符：" class="headerlink" title="比较符："></a>比较符：</h4><ul><li><code>==</code> 等于</li><li><code>!=</code> 不等于</li><li><code>&gt;</code> 大于</li><li><code>&lt;</code> 小于</li><li><code>&gt;=</code> 大于等于</li><li><code>&lt;=</code> 小于等于</li></ul><h4 id="逻辑操作符："><a href="#逻辑操作符：" class="headerlink" title="逻辑操作符："></a>逻辑操作符：</h4><ul><li>and 两个条件同时满足</li><li>or 其中一个条件被满足</li><li>xor 有且仅有一个条件被满足</li><li>not 没有条件被满足</li></ul><h4 id="ip地址："><a href="#ip地址：" class="headerlink" title="ip地址："></a>ip地址：</h4><ul><li>ip.addr ip地址</li><li>ip.src 源ip</li><li>ip.dst 目标ip</li></ul><h4 id="端口过滤："><a href="#端口过滤：" class="headerlink" title="端口过滤："></a>端口过滤：</h4><ul><li>tcp.port</li><li>tcp.srcport</li><li>tcp.dstport</li><li>tcp.flags.syn 过滤包含tcp的syn请求的包</li><li>tcp.flags.ack 过滤包含tcp的ack应答的包</li></ul><h4 id="协议过滤："><a href="#协议过滤：" class="headerlink" title="协议过滤："></a>协议过滤：</h4><p>arp、ip、icmp、udp、tcp、bootp、dns</p><h4 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h4><p>过滤IP地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip.addr &#x3D;&#x3D; 192.168.1.101   过滤该地址的包</span><br><span class="line">ip.src &#x3D;&#x3D; 172.16.1.101  过滤源地址为该地址的包</span><br></pre></td></tr></table></figure><p>过滤端口：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp.port &#x3D;&#x3D; 80 过滤tcp中端口号为80的包</span><br><span class="line">tcp.flags.syn &#x3D;&#x3D; 1 过滤syn请求为1的包</span><br></pre></td></tr></table></figure><h2 id="Wireshark高级功能"><a href="#Wireshark高级功能" class="headerlink" title="Wireshark高级功能"></a>Wireshark高级功能</h2><h3 id="数据追踪流"><a href="#数据追踪流" class="headerlink" title="数据追踪流"></a>数据追踪流</h3><p>主要是将TCP、UDP、SSL数据流进行重组并完整呈现出来</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/16.png" alt="16"></p><h3 id="捕获文件属性"><a href="#捕获文件属性" class="headerlink" title="捕获文件属性"></a>捕获文件属性</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/17.png" alt="17"></p><h3 id="专家信息"><a href="#专家信息" class="headerlink" title="专家信息"></a>专家信息</h3><p>Wireshark会跟在踪捕获文件中发现的任何异常和其他感兴趣的项目，并将其显示在“专家信息”对话框中。目的是让您更好地了解不常见或值得注意的网络行为，并使新手和专家用户比手动扫描数据包列表更快地发现网络问题。</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/18.png" alt="18"></p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/19.png" alt="19"></p><p>每个专家信息项都有一个严重性级别。从最低到最高使用以下级别。Wireshark使用不同的颜色标记它们，这些颜色显示在括号中：</p><ul><li>聊天（蓝色）<ul><li>有关常规工作流程的信息，例如设置了SYN标志的TCP数据包。</li></ul></li><li>注意（青色）<ul><li>值得注意的事件，例如应用程序返回了常见的错误代码，例如HTTP 404。</li></ul></li><li>警告（黄色）<ul><li>警告，例如应用程序返回了异常错误代码，例如连接问题。</li></ul></li><li>错误（红色）<ul><li>严重的问题，例如格式错误的数据包。</li></ul></li></ul><h3 id="协议分层统计"><a href="#协议分层统计" class="headerlink" title="协议分层统计"></a>协议分层统计</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/20.png" alt="20"></p><h3 id="网络节点及会话统计"><a href="#网络节点及会话统计" class="headerlink" title="网络节点及会话统计"></a>网络节点及会话统计</h3><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/21.png" alt="21"></p><p>针对性的去分析，如流量情况等。</p><h3 id="图表分析"><a href="#图表分析" class="headerlink" title="图表分析"></a>图表分析</h3><p>可以用来进行报告图形化流量展示。</p><p><img src="https://na1r.oss-cn-beijing.aliyuncs.com/wireshark/22.png" alt="22"></p><ul><li>参考文档</li></ul><p><a href="https://blog.csdn.net/Eastmount/article/details/101101829" target="_blank" rel="noopener" title="[网络安全自学篇] 十三.Wireshark抓包原理（ARP劫持、MAC泛洪）及数据流追踪和图像抓取（二）">[网络安全自学篇] 十三.Wireshark抓包原理（ARP劫持、MAC泛洪）及数据流追踪和图像抓取（二）</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Wireshark </tag>
            
            <tag> 流量 </tag>
            
            <tag> 抓包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webshell检测</title>
      <link href="/2020/03/29/Webshell%E6%A3%80%E6%B5%8B/"/>
      <url>/2020/03/29/Webshell%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="WebShell简介"><a href="#WebShell简介" class="headerlink" title="WebShell简介"></a>WebShell简介</h1><p>Web指的是在web服务器上，而shell是用脚本语言编写的脚本程序，webshell就是就是Web的一个管理工具，可以对web服务器进行操作的权限，也叫webadmin。</p><a id="more"></a><p>webshell一般是被网站管理员用于网站管理、服务器管理等等一些用途，但是由于webshell的功能比较强大，可以上传下载文件，查看数据库，甚至可以调用一些服务器上系统的相关命令（比如创建用户，修改删除文件之类的），通常被黑客利用，黑客通过一些上传方式，将自己编写的webshell上传到web服务器的页面的目录下，然后通过页面访问的形式进行入侵，或者通过插入一句话连接本地的一些相关工具直接对服务器进行入侵操作。</p><h2 id="Webshelld分类"><a href="#Webshelld分类" class="headerlink" title="Webshelld分类"></a>Webshelld分类</h2><p>小马：体积小，代码量少，常见的一句话木马<code>&lt;?php @eval($_POST[&#39;attack&#39;]) ?&gt;</code>，可以通过中国菜刀等工具去连接操作。</p><p>大马：体积大，功能齐全；通常会使用系统关键函数</p><p><img src="https://s1.ax1x.com/2020/03/29/GZ9VpV.png" alt="大马"></p><p>常见的像asp、jsp、php等编程语言编写的shell脚本</p><p><img src="https://s1.ax1x.com/2020/03/29/GZP6eg.png" alt="Webshell特征"></p><h2 id="WebShell管理工具"><a href="#WebShell管理工具" class="headerlink" title="WebShell管理工具"></a>WebShell管理工具</h2><ul><li>中国蚁剑AntSword</li><li>中国菜刀 (caidao)</li><li>冰蝎 webshell</li><li>cknife (c刀)</li><li>xise</li><li>QuasiBot</li><li>WeBaCoo</li><li>Weevely</li><li>Fastener</li><li>Altman</li><li>Webshell-Sniper</li></ul><h2 id="Webshell检测方法"><a href="#Webshell检测方法" class="headerlink" title="Webshell检测方法"></a>Webshell检测方法</h2><h3 id="静态检测"><a href="#静态检测" class="headerlink" title="静态检测"></a>静态检测</h3><p>静态检测指对脚本文件中所使用的特征码，特征值、关键词、高危函数、文件修改的时间、文件权限、文件的所有者以及和其它文件的关联性等多个维度的特征进行检测，</p><ul><li><p>缺点</p><ul><li>只能查找已知的webshell</li><li>误报率漏报率较高</li><li>容易被绕过</li></ul></li><li><p>优点：</p><ul><li>快速方便，对已知的webshell查找准确率高</li><li>部署方便</li><li>一般情况下需要配合人工</li></ul></li></ul><h3 id="动态检测"><a href="#动态检测" class="headerlink" title="动态检测"></a>动态检测</h3><p>动态特征检测通过Webshell运行时使用的系统命令或者网络流量及状态的异常来判断动作的威胁程度，Webshell通常会被加密从而避免静态特征的检测，当Webshell运行时就必须向系统发送系统命令来达到控制系统或者操作数据库的目的，通过检测系统调用来监测甚至拦截系统命令被执行，从行为模式上深度检测脚本文件的安全性。</p><ul><li><p>优点：</p><ul><li>可用于网站集群，对新型变种脚本有一定的检测能力。</li></ul></li><li><p>缺点：</p><ul><li>针对特定用途的后门较难检测,实施难度较大。</li></ul></li></ul><h3 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h3><p>使用Webshell一般不会在系统日志中留下记录，但是会在网站的web日志中留下Webshell页面的访问数据和数据提交记录。日志分析检测技术通过大量的日志文件建立请求模型从而检测出异常文件，称之为：HTTP异常请求模型检测。例如：一个平时是GET的请求突然有了POST请求并且返回代码为200、某个页面的访问者IP、访问时间具有规律性等。</p><ul><li><p>优点：</p><ul><li>采用了一定数据分析的方式，网站的访问量达到一定量级时这种检测方法的结果具有较大参考价值。</li></ul></li><li><p>缺点：</p><ul><li>存在一定误报，对于大量的访问日志，检测工具的处理能力和效率会比较低。</li></ul></li></ul><h3 id="语法检测"><a href="#语法检测" class="headerlink" title="语法检测"></a>语法检测</h3><p>根据php语言扫描编译的实现方式，进行剥离代码、注释，分析变量、函数、字符串、语言结构的分析方式，来实现关键危险函数的捕捉方式。</p><h2 id="变形、窃密型webshell检测"><a href="#变形、窃密型webshell检测" class="headerlink" title="变形、窃密型webshell检测"></a>变形、窃密型webshell检测</h2><h3 id="基于数据库操作审计的检测方式"><a href="#基于数据库操作审计的检测方式" class="headerlink" title="基于数据库操作审计的检测方式"></a>基于数据库操作审计的检测方式</h3><p>针对窃密型Webshell必须具有操作数据库的能力，可以引申出一种新的检测方法，通过分析正常WEB脚本文件和窃密型Webshell对数据库操作的差异进行分析是本检测方法所重点研究的方向。正常情况下WEB站点进行数据操作的过程应该是重复性且较为复杂的查询过程，这种查询通常精确度非常高，查询过程不会出现类似于“select * from”这种查询语句。正常的WEB脚本在进行数据库操作的过程中也不会出现跨越数据库查询的情况，一旦出现这种现象基本可以判断为非正常的WEB脚本操作过程。</p><h3 id="建立机器学习日志分析系统"><a href="#建立机器学习日志分析系统" class="headerlink" title="建立机器学习日志分析系统"></a><strong>建立机器学习日志分析系统</strong></h3><p>由于数据库操作记录日志量非常大，使用人工的方法难以进行精确筛选和审计。所以需要建立一套机器自学习的日志审计系统。该日志审计系统主要基于查询模型白名单学习与数学统计模型这两方面进行设计。</p><h2 id="Webshell检测工具"><a href="#Webshell检测工具" class="headerlink" title="Webshell检测工具"></a>Webshell检测工具</h2><h3 id="D盾"><a href="#D盾" class="headerlink" title="D盾"></a>D盾</h3><p>支持系统:win2003/win2008/win2012/win2016<br>PHP支持:FastCGI/ISAPI (版本:5.x至7.x)</p><p><a href="http://www.d99net.net/down/d_safe_2.1.5.4.zip" target="_blank" rel="noopener">点击下载</a> | <a href="http://www.d99net.net/News.asp?id=106" target="_blank" rel="noopener">安装与使用说明</a></p><p><img src="https://s1.ax1x.com/2020/03/29/GZVH0K.png" alt="D盾"></p><h3 id="WEBDIR-："><a href="#WEBDIR-：" class="headerlink" title="WEBDIR+："></a>WEBDIR+：</h3><p>需要用户自行上传可疑文件。</p><p>支持的文件类型 php, phtml, inc, php3, php4, php5, war, jsp, jspx, asp, aspx, cer, cdx, asa, ashx, asmx, cfm</p><p>支持的压缩包 rar, zip, tar, xz, tbz, tgz, tbz2, bz2, gz</p><p><img src="https://s1.ax1x.com/2020/03/29/GZZKBV.png" alt=""></p><h3 id="WebShell-Detector"><a href="#WebShell-Detector" class="headerlink" title="WebShell Detector"></a>WebShell Detector</h3><p>可以识别和发现php/cgi(perl)/asp/aspx的shell</p><p><img src="https://s1.ax1x.com/2020/03/29/GZZx5F.png" alt="WebShell Detector"></p><h3 id="WEBSHELL-PUB"><a href="#WEBSHELL-PUB" class="headerlink" title="WEBSHELL.PUB"></a>WEBSHELL.PUB</h3><p>GUI/在线WebShell扫描检测查杀</p><p><img src="https://s1.ax1x.com/2020/03/29/GZeyIU.png" alt="河马"></p><ul><li><p>参考来源</p><p><a href="https://www.cnblogs.com/he1m4n6a/p/9245155.html" target="_blank" rel="noopener" title="webshell检测方法归纳">webshell检测方法归纳</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webshell </tag>
            
            <tag> 一句话木马 </tag>
            
            <tag> 中国菜刀 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分块传输</title>
      <link href="/2019/03/23/%E5%88%86%E5%BF%AB%E4%BC%A0%E8%BE%93/"/>
      <url>/2019/03/23/%E5%88%86%E5%BF%AB%E4%BC%A0%E8%BE%93/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>分块传输编码（Chunked transfer encoding）是超文本传输协议（HTTP）中的一种数据传输机制，允许HTTP由网页服务器发送给客户端应用（ 通常是网页浏览器）的数据可以分成多个部分。分块传输编码只在HTTP协议1.1版本（HTTP/1.1）中提供。<br>通常，HTTP应答消息中发送的数据是整个发送的，Content-Length消息头字段表示数据的长度。</p><a id="more"></a><p>数据的长度很重要，因为客户端需要知道哪里是应答消息的结束，以及后续应答消息的开始。然而，使用分块传输编码，数据分解成一系列数据块，并以一个或多个块发送，这样服务器可以发送数据而不需要预先知道发送内容的总大小。通常数据块的大小是一致的，但也不总是这种情况。</p><h2 id="Transfer-Encoding-分块传输"><a href="#Transfer-Encoding-分块传输" class="headerlink" title="Transfer-Encoding 分块传输"></a>Transfer-Encoding 分块传输</h2><p><strong>如果存在Transfer-Encoding（重点是chunked），则在header中不能有Content-Length，有也会被忽视。每个块以16进制数值表示当前块的数据大小，然后\r\n；再然后是当前chunk的数据内容，接着是\r\n；结束块（终止块）是一个常规块，但长度为零。当读取到chunk 的数据大小是0时，意味着请求或响应数据已经分块传输完毕。</strong></p><p>例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK </span><br><span class="line">Content-Type: text&#x2F;plain </span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">7\r\n       大小：7字节</span><br><span class="line">Mozilla\r\n    chunk内容</span><br><span class="line"></span><br><span class="line">9\r\n       大小：9字节</span><br><span class="line">Developer\r\n   chunk内容</span><br><span class="line"></span><br><span class="line">7\r\n       大小：7字节</span><br><span class="line">Network\r\n    chunk内容</span><br><span class="line"></span><br><span class="line">0\r\n       结束块，0字节</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure><h2 id="利用分块传输吊打所有WAF"><a href="#利用分块传输吊打所有WAF" class="headerlink" title="利用分块传输吊打所有WAF"></a>利用分块传输吊打所有WAF</h2><p><a href="https://www.anquanke.com/post/id/169738" target="_blank" rel="noopener" title="利用分块传输吊打所有WAF">利用分块传输吊打所有WAF</a></p><h2 id="Burp-suite-分块传输辅助插件"><a href="#Burp-suite-分块传输辅助插件" class="headerlink" title="Burp suite 分块传输辅助插件"></a>Burp suite 分块传输辅助插件</h2><p><a href="https://github.com/c0ny1/chunked-coding-converter" target="_blank" rel="noopener">https://github.com/c0ny1/chunked-coding-converter</a></p><h3 id="插件编译"><a href="#插件编译" class="headerlink" title="插件编译"></a>插件编译</h3><p><code>mvn package</code></p><h3 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h3><p><img src="https://github.com/c0ny1/chunked-coding-converter/raw/master/doc/menu.png" alt="avatar"></p><p><img src="https://github.com/c0ny1/chunked-coding-converter/raw/master/doc/config.png" alt="avatar"></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>1.<a href="https://zh.wikipedia.org/wiki/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81</a></p><p>2.<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Transfer-Encoding" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Transfer-Encoding</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 过Waf </tag>
            
            <tag> 分块传输 </tag>
            
            <tag> 插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali美化</title>
      <link href="/2019/03/18/kali%E7%BE%8E%E5%8C%96/"/>
      <url>/2019/03/18/kali%E7%BE%8E%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p><strong>kali自带的界面太丑了，终于忍不住下手了</strong></p><a id="more"></a><h2 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h2><p>安装<code>gnome-tweak-tool</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gnome-tweak-tool</span><br></pre></td></tr></table></figure><p>kali主题下载地址</p><blockquote><p><a href="http://gnome-look.org" target="_blank" rel="noopener">http://gnome-look.org</a></p></blockquote><p>将下载好的theme放入<code>/usr/share/themes</code></p><p>博主的主题是</p><blockquote><p><a href="https://github.com/vinceliuice/Qogir-theme" target="_blank" rel="noopener">https://github.com/vinceliuice/Qogir-theme</a></p></blockquote><p>使用方式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;vinceliuice&#x2F;Qogir-theme.git</span><br><span class="line"></span><br><span class="line">sudo apt-get install gtk2-engines-murrine gtk2-engines-pixbuf</span><br><span class="line"></span><br><span class="line">cd Qogir-thme</span><br><span class="line"></span><br><span class="line">.&#x2F;install</span><br></pre></td></tr></table></figure><h2 id="更换图标"><a href="#更换图标" class="headerlink" title="更换图标"></a>更换图标</h2><p>将下载好的图标文件放入</p><p><code>/usr/share/icons</code></p><p><img src="https://s2.ax1x.com/2019/03/18/AnFe29.png" alt="AnFe29.png"></p><p>终端输入<code>gnome-tweaks</code></p><p><img src="https://s2.ax1x.com/2019/03/18/AniRAO.png" alt="AniRAO.png"></p><p>搞定！</p>]]></content>
      
      
      <categories>
          
          <category> 分享经验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 美化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>服务器加固</title>
      <link href="/2019/03/11/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A0%E5%9B%BA/"/>
      <url>/2019/03/11/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A0%E5%9B%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="linux加固"><a href="#linux加固" class="headerlink" title="linux加固"></a>linux加固</h2><h3 id="一、系统默认账号及组管理"><a href="#一、系统默认账号及组管理" class="headerlink" title="一、系统默认账号及组管理"></a>一、系统默认账号及组管理</h3><blockquote><p>删除系统默认不使用的帐号，包括：lp、mail、games、ftp、nobody、postfix等。删除系统默认不使用的组，包括：mail、games、ftp、nobody、postfix等。</p></blockquote><a id="more"></a><h3 id="二、启用密码策略"><a href="#二、启用密码策略" class="headerlink" title="二、启用密码策略"></a>二、启用密码策略</h3><ol><li>密码60天过期，修改密码最小间隔为1天，最短密码要求8，密码过期前7天通知用户。</li></ol><p>修改 <code>/etc/login.defs</code>来实现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PASS_MAX_DAYS   60</span><br><span class="line">PASS_MIN_DAYS   1</span><br><span class="line">PASS_MIN_LEN    8</span><br><span class="line">PASS_WARN_AGE   7</span><br></pre></td></tr></table></figure><ol start="2"><li>连续3次输入密码错误，锁定5分钟，主要防止爆破</li></ol><p>修改<code>/etc/pam.d/system-auth</code>文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auth required pam_env.so</span><br><span class="line"></span><br><span class="line">auth required pam_tally2.so deny&#x3D;3 unlock_time&#x3D;300</span><br></pre></td></tr></table></figure><h3 id="三、SSH安全配置"><a href="#三、SSH安全配置" class="headerlink" title="三、SSH安全配置"></a>三、SSH安全配置</h3><ol><li>禁止root登录，禁止空口零登录</li></ol><p>修改配置文件 <code>/etc/ssh/sshd_config</code></p><blockquote><p>ssh  v1存在缺陷，不能使用这个版本的，应该使用SSH V2</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Protocol 2         #只使用协议版本2</span><br><span class="line">PermitRootLogin no #禁止root登录</span><br><span class="line">PermitEmptyPasswords no #禁止空口令登录</span><br></pre></td></tr></table></figure><p>新建一个用户 useradd <code>testuser</code> ,设置密码 passwd <code>testpass</code> 密码8位以上，使用testuser 登录服务器，在 su到root用户。</p><p>重启服务<br><code>service sshd restart</code></p><ol start="2"><li>长时间无人操作自动断开ssh连接</li></ol><p>修改配置文件<code>/etc/profile</code> 在末尾加上</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TMOUT&#x3D;300    # 单位是秒</span><br></pre></td></tr></table></figure><h3 id="四、禁用所有特殊账户"><a href="#四、禁用所有特殊账户" class="headerlink" title="四、禁用所有特殊账户"></a>四、禁用所有特殊账户</h3><p>应该从系统中删除所有默认用户和组<br>例如 news,lp,sync,shutdown,uucp,games,halt 等<br>方法：<br>删除账户 <code>userdel name</code><br>删除组 <code>groupdel name</code></p><h3 id="五、检测监听的端口"><a href="#五、检测监听的端口" class="headerlink" title="五、检测监听的端口"></a>五、检测监听的端口</h3><p>检测是否有必要开放端口是非常重要的<br>方法：<br><code>netstat -tulp</code></p><h2 id="Apache-加固"><a href="#Apache-加固" class="headerlink" title="Apache 加固"></a>Apache 加固</h2><h3 id="禁止Apache访问Web目录之外的任何文件"><a href="#禁止Apache访问Web目录之外的任何文件" class="headerlink" title="禁止Apache访问Web目录之外的任何文件"></a>禁止Apache访问Web目录之外的任何文件</h3><p>编辑 httpd.conf配置文件，修改为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory &#x2F;&gt;</span><br><span class="line">Order Deny,Allow</span><br><span class="line">Deny from all</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br></pre></td></tr></table></figure><p>如果apache必须要访问web目录以外的目录或文件，可以设置可访问目录，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory &#x2F;web&gt;</span><br><span class="line">Order Allow,Deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br></pre></td></tr></table></figure><p>其中/web为网站根目录。</p><h3 id="防止apache列目录"><a href="#防止apache列目录" class="headerlink" title="防止apache列目录"></a>防止apache列目录</h3><p>(1) 编辑httpd.conf配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory &quot;&#x2F;web&quot;&gt;</span><br><span class="line">Options FollowSymLinks</span><br><span class="line">AllowOverride None</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br></pre></td></tr></table></figure><p>将Options Indexes FollowSymLinks中的Indexes去掉，就可以禁止Apache显示该目录结构。Indexes的作用就是当该目录下没有index.html文件时，就显示目录结构。</p><p>(2)设置 Apache 的默认页面，编辑%apache%\conf\httpd.conf配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">        DirectoryIndex index.html</span><br><span class="line">&lt;&#x2F;IfModule&gt;</span><br></pre></td></tr></table></figure><p>其中index.html即为默认页面，可根据情况改为其它文件。</p><p>(3)重新启动 Apache 服务</p><h2 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h2><h3 id="MYSQL权限详细分类"><a href="#MYSQL权限详细分类" class="headerlink" title="MYSQL权限详细分类"></a>MYSQL权限详细分类</h3><p>全局管理权限：</p><p>FILE: 在MySQL服务器上读写文件。</p><p>PROCESS: 显示或杀死属于其它用户的服务线程。</p><p>RELOAD: 重载访问控制表，刷新日志等。</p><p>SHUTDOWN: 关闭MySQL服务。</p><p>数据库/数据表/数据列权限：</p><p>ALTER: 修改已存在的数据表(例如增加/删除列)和索引。</p><p>CREATE: 建立新的数据库或数据表。</p><p>DELETE: 删除表的记录。</p><p>DROP: 删除数据表或数据库。</p><p>INDEX: 建立或删除索引。</p><p>INSERT: 增加表的记录。</p><p>SELECT: 显示/搜索表的记录。</p><p>UPDATE: 修改表中已存在的记录。</p><p>特别的权限：</p><p>ALL: 允许做任何事(和root一样)。</p><p>USAGE: 只允许登录–其它什么也不允许做。</p><h3 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h3><table><thead><tr><th>账户</th><th>权限</th><th>登录</th></tr></thead><tbody><tr><td>root</td><td>禁用file权限</td><td>仅限localhost</td></tr><tr><td>user</td><td>禁用file权限，禁止新建库</td><td>仅限localhost</td></tr></tbody></table><h3 id="账户安全"><a href="#账户安全" class="headerlink" title="账户安全"></a>账户安全</h3><p>权限需求：</p><p>select, insert, update, delete, alter, create, index</p><h3 id="用户授权方法"><a href="#用户授权方法" class="headerlink" title="用户授权方法"></a>用户授权方法</h3><p>创建用户并仅限本地登录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#39;senna&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>如果要允许远程登录，则将上述语句中的localhost改为%</p></blockquote><p>比如设置mysql账户senna对数据库user有select，insert，update，delete权限，但没有drop权限，则执行SQL语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT select，insert，update，delete ON USER TO senna@&quot;localhost&quot;;</span><br></pre></td></tr></table></figure><p>如果要赋予某用户对某库的所有控制权，则语句为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON USER TO senna@&quot;localhost&quot;;</span><br></pre></td></tr></table></figure><p>最后重载授权表：<br>FLUSH PRIVILEGES;</p><p>可以适用GRANT语句直接新建mysql账户并完成指定数据库的授权，比如创建一个senna用户，密码为123456，并且只能对user数据库进行操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL ONuser.* TO senna IDENTIFIED BY &quot;123456&quot;;</span><br></pre></td></tr></table></figure><h3 id="禁止远程登录"><a href="#禁止远程登录" class="headerlink" title="禁止远程登录"></a>禁止远程登录</h3><p>限制所有的mysql账户都只能在localhost登录，禁止远程登录。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update mysql.user set HOST&#x3D;&#39;localhost&#39;</span><br></pre></td></tr></table></figure><h3 id="禁用file权限"><a href="#禁用file权限" class="headerlink" title="禁用file权限"></a>禁用file权限</h3><p>禁用所有mysql账户的file权限。</p><p>以root权限登录数据库，执行SQL：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE mysql.user SET File_priv &#x3D; &#39;N&#39;;</span><br></pre></td></tr></table></figure><p>如果要禁止单个用户的file权限，在上述语句中跟上where子句即可：</p><p>UPDATE mysql.user SET File_priv = ‘N’; WHERE USER=’root’</p><p>只有root可以新建/删除库，禁用其他mysql账户新建/删除库的权限。</p><p>禁止将process或super权限赋给非管理员用户。</p><h3 id="修改默认mysql管理员帐号"><a href="#修改默认mysql管理员帐号" class="headerlink" title="修改默认mysql管理员帐号"></a>修改默认mysql管理员帐号</h3><p>系统mysql的管理员名称是root，一般情况下都没进行修改</p><p>执行：</p><p>update user set user=”fds654dtasd” where user=”root”;</p><p>flush privileges;</p><p><strong>暂时就这些吧，还有好多如nginx、php等还未更新。。。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 加固 </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>入侵痕迹清理</title>
      <link href="/2019/03/09/%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/"/>
      <url>/2019/03/09/%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="登录日志清除"><a href="#登录日志清除" class="headerlink" title="登录日志清除"></a>登录日志清除</h2><p>以下命令的输出信息里包括了登录用户名、最近登陆时间、IP地址等信。</p><a id="more"></a><ul><li><p>成功登录用户<br><code>last</code>命令，对应的日志文件<code>/var/log/wtmp</code></p></li><li><p>尝试登录信息<br><code>lastb</code>命令，对应的日志文件<code>/var/log/btmp</code></p></li><li><p>显示最近登录信息<br><code>lastlog</code>命令，对应的日志文件<code>/var/log/lastlog</code></p></li></ul><p><strong>清空日志文件：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &gt; &#x2F;var&#x2F;log&#x2F;wtmp</span><br><span class="line"></span><br><span class="line">echo &gt; &#x2F;var&#x2F;log&#x2F;btmp</span><br><span class="line"></span><br><span class="line">echo &gt; &#x2F;var&#x2F;log&#x2F;lastlog</span><br></pre></td></tr></table></figure><p><strong>清除Bash历史</strong></p><p>linux中存放历史命令的文件是<code>.bash_history</code>，<br>清空该文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &gt; &#x2F;root&#x2F;.bash_history</span><br></pre></td></tr></table></figure><p>也可以在输入指令的时候指定Bash不保存历史</p><p><code>&lt;空格&gt;command</code></p><p><strong>清除当前登录session的历史：</strong></p><p>history -r</p><p><strong>清除所有历史：</strong></p><p>history -cw</p><p><strong>在真实的入侵情况下需要处理的日志文件非常多，这里就简单讲一小部分</strong></p><h2 id="logtamper"><a href="#logtamper" class="headerlink" title="logtamper"></a>logtamper</h2><p><strong>一款使用python编写的修改Linux日志工具</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;re4lity&#x2F;logtamper.git</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">躲避管理员w查看</span><br><span class="line"></span><br><span class="line">python logtamper.py -m 1 -u re4lity -i 192.168.0.188</span><br><span class="line"></span><br><span class="line">清除指定ip的登录日志</span><br><span class="line"></span><br><span class="line">python logtamper.py -m 2 -u re4lity -i 192.168.0.188</span><br><span class="line"></span><br><span class="line">修改上次登录时间地点</span><br><span class="line"></span><br><span class="line">python logtamper.py -m 3 -u re4lity -i 192.168.0.188 -t tty1 -d 2014:05:28:10:11:12</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日志清除 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OWASP Top 10 - 2017</title>
      <link href="/2019/03/02/OWASP%20Top%2010%20-%202017/"/>
      <url>/2019/03/02/OWASP%20Top%2010%20-%202017/</url>
      
        <content type="html"><![CDATA[<p>最近要找工作了，花点时间整理整理知识点补一补。</p><h2 id="Top1-注入"><a href="#Top1-注入" class="headerlink" title="Top1 注入"></a>Top1 注入</h2><p><strong>将不受信任的数据作为命令或查询的一部分发送到解析器时，会产生如SQL注入、OS注入和LDAP（轻量目录访问协议）注入的注入缺陷。攻击者的恶意数据可以诱使解析器在没有适当授权的情况下执行非预期命令或访问数据。</strong></p><a id="more"></a><h3 id="危害："><a href="#危害：" class="headerlink" title="危害："></a>危害：</h3><pre><code>注入可以导致数据丢失或被破坏，缺乏可审计性或拒绝服务。注入漏洞有时甚至可导致完全接管主机。</code></pre><h3 id="如何防御"><a href="#如何防御" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">使用安全的API，避免使用解释器</span><br><span class="line"></span><br><span class="line">参数化查询</span><br><span class="line"></span><br><span class="line">转义</span><br><span class="line"></span><br><span class="line">白名单</span><br></pre></td></tr></table></figure><h2 id="Top2-失效的身份认证和会话管理"><a href="#Top2-失效的身份认证和会话管理" class="headerlink" title="Top2 失效的身份认证和会话管理"></a>Top2 失效的身份认证和会话管理</h2><p><strong>通常，通过错误使用应用程序的身份认证和会话管理功能，攻击者能够破译密码、密钥或绘画令牌，或者利用其它开发缺陷来暂时性或永久性冒充其他用户的身份。</strong></p><p><code>密码管理、超时、密码找回等</code></p><h3 id="危害：-1"><a href="#危害：-1" class="headerlink" title="危害："></a>危害：</h3><pre><code>可能导致部分甚至全部账户遭受攻击，攻击者一旦成功，攻击者能执行受害用户的任何操作。因此管理员账户、特权账户是常见的攻击目标</code></pre><h3 id="如何防御-1"><a href="#如何防御-1" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">账号密码密文传输</span><br><span class="line"></span><br><span class="line">设置密码和会话有效期，使用强密码</span><br><span class="line"></span><br><span class="line">限制或逐渐延迟失败的登录尝试</span><br><span class="line"></span><br><span class="line">SSL</span><br></pre></td></tr></table></figure><h2 id="Top3-敏感数据泄露"><a href="#Top3-敏感数据泄露" class="headerlink" title="Top3 敏感数据泄露"></a>Top3 敏感数据泄露</h2><p><strong>许多Web应用程序和API都无法正确的保护敏感数据，例如:财务数据、用户数据等、攻击者可以通过窃取或修改未加密的数据来实施诈骗、身份盗窃等犯罪行为。未加密的敏感数据容易受到破坏，因此，我们需要对敏感数据加密，这些数据包括：传输过程中的数据、存储的数据以及浏览器的交互数据。</strong></p><h3 id="如何防御-2"><a href="#如何防御-2" class="headerlink" title="如何防御"></a>如何防御</h3><p><strong>注重保护重要数据，对于员工需要进行安全意识培训。</strong></p><h2 id="Top4-XML外部实体（XXE）"><a href="#Top4-XML外部实体（XXE）" class="headerlink" title="Top4 XML外部实体（XXE）"></a>Top4 XML外部实体（XXE）</h2><p>*<em>XXE漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件和代码 *</em></p><h3 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h3><pre><code>造成任意文件读取、命令执行、内网端口扫描、攻击内网网站、发起Dos攻击等危害。</code></pre><h3 id="如何防御-3"><a href="#如何防御-3" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">禁止外部实体的解析</span><br><span class="line"></span><br><span class="line">过滤用户提交的XML数据</span><br></pre></td></tr></table></figure><h2 id="Top5-失效的访问控制"><a href="#Top5-失效的访问控制" class="headerlink" title="Top5 失效的访问控制"></a>Top5 失效的访问控制</h2><p><strong>未对通过身份验证的用户实施恰当的访问控制。攻击者可以利用这些缺陷访问未经授权的功能或数据</strong></p><h3 id="危害：-2"><a href="#危害：-2" class="headerlink" title="危害："></a>危害：</h3><pre><code>例如：访问其他用户的账户、查看敏感文件、修改其他用户的数据、更改访问权限等。</code></pre><h3 id="如何防御-4"><a href="#如何防御-4" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">除了公共资源，其他默认拒绝访问。</span><br><span class="line"></span><br><span class="line">使用一次性的访问控制机制，并在整个应用程序中不断重用它们。</span><br><span class="line"></span><br><span class="line">禁用Web服务器目录列表，并确保文件元数据不存在于 Web的根目录中。</span><br><span class="line"></span><br><span class="line">记录失败的访问控制，并在适当时向管理员告警）。</span><br><span class="line"></span><br><span class="line">当用户注销后，服务器上的JWT令牌应失效。</span><br></pre></td></tr></table></figure><h2 id="Top6-安全配置错误"><a href="#Top6-安全配置错误" class="headerlink" title="Top6 安全配置错误"></a>Top6 安全配置错误</h2><p><strong>安全配置错误是最常见的安全问题，通常是由于不安全的默认配置、不完整的临时配置、开源云存储、错误的HTTP标头配置以及包含敏感信息的详细信息所造成的。因此我们不仅需要对所有的操作系统、框架、库和应用程序进行安全配置，而且必须及时修补和升级它们。</strong></p><h3 id="危害：-3"><a href="#危害：-3" class="headerlink" title="危害："></a>危害：</h3><pre><code>系统可能在未知的情况下被完全攻破，用户数据可能随着时间被全部盗走或篡改。甚至导致整个系统被完全破坏</code></pre><h3 id="如何防御-5"><a href="#如何防御-5" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">自动化安装部署</span><br><span class="line"></span><br><span class="line">搭建最小化的平台，不包含任何不必要的功能、组件等。</span><br><span class="line"></span><br><span class="line">了解并部署每个环节的软件更新和补丁信息。</span><br><span class="line"></span><br><span class="line">漏洞扫描和安全审计</span><br></pre></td></tr></table></figure><h2 id="Top7-跨站脚本（XSS）"><a href="#Top7-跨站脚本（XSS）" class="headerlink" title="Top7 跨站脚本（XSS）"></a>Top7 跨站脚本（XSS）</h2><p><strong>跨站脚本是最普遍的web应用安全漏洞。当应用程序在发送给浏览器的页面中包含用户提供的数据，但没有经过适当验证和转义，就会导致跨站</strong></p><h3 id="危害：-4"><a href="#危害：-4" class="headerlink" title="危害："></a>危害：</h3><pre><code>攻击者在受害者浏览器中执行脚本以劫持用户会话，插入恶意内容，重定向用户，使用恶意软件劫持用户浏览器等</code></pre><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p><strong>反射型：恶意代码并没有保存在目标服务器（目标网站）上，而是攻击者通过引诱用户点击一个链接到目标网站的恶意链接来实施攻击。</strong></p><p><strong>DOM型:客户端由浏览器去解析执行。类似反射型XSS。</strong></p><p><strong>存储型：恶意代码被保存在目标服务器（目标网站）上，这种攻击具有较强的稳定性和持久性，所有访问镶嵌恶意代码页面的用户都会被攻击。</strong></p><h3 id="如何防御-6"><a href="#如何防御-6" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">验证输入</span><br><span class="line"></span><br><span class="line">编码输出（确保输入的字符为数据）</span><br></pre></td></tr></table></figure><h2 id="Top8-不安全的反序列化"><a href="#Top8-不安全的反序列化" class="headerlink" title="Top8 不安全的反序列化"></a>Top8 不安全的反序列化</h2><p>*<em>说起反序列化首先要知道序列化是什么，序列化就是把对象转换成字节流，以便于保存在内存、文件数据库中；那反序列化就是逆过程，从字节流还原成对象。所以要利用反序列化漏洞，就需要在进行反序列化的地方传入攻击者的序列化代码。<br>*</em></p><h3 id="危害：-5"><a href="#危害：-5" class="headerlink" title="危害："></a>危害：</h3><pre><code>不安全的反序列化会导致远程代码执行。即使反序列化缺陷不会导致远程代码执行，攻击者也可以利用它们来执行攻击，包括：重放攻击、注入攻击和特权提升等。</code></pre><h3 id="如何防御-7"><a href="#如何防御-7" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">对序列化对象执行完整性检查和加密处理，防止被恶意篡改和创建恶意对象。</span><br><span class="line"></span><br><span class="line">反序列化过程之前执行严格的类型限制。</span><br><span class="line"></span><br><span class="line">隔离反序列化的代码，将其放在低权限的状态下运行。</span><br><span class="line"></span><br><span class="line">监视反序列化的过程。</span><br></pre></td></tr></table></figure><h2 id="Top9-使用含有已知漏洞的组件"><a href="#Top9-使用含有已知漏洞的组件" class="headerlink" title="Top9 使用含有已知漏洞的组件"></a>Top9 使用含有已知漏洞的组件</h2><p><strong>应用程序使用带有已知漏洞的组件会破坏应用程序防御系统，可能导致严重的数据丢失或服务器接管</strong></p><h3 id="如何防御-8"><a href="#如何防御-8" class="headerlink" title="如何防御"></a>如何防御</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">移除不用的依赖、功能组件等。</span><br><span class="line"></span><br><span class="line">监控CVE，NVD等是否发布已使用组件的相关漏洞信息</span><br><span class="line"></span><br><span class="line">仅从官方渠道获取组件。</span><br><span class="line"></span><br><span class="line">监控不在维护的库和组件等。</span><br></pre></td></tr></table></figure><h2 id="Top10-不足的日志记录和监控"><a href="#Top10-不足的日志记录和监控" class="headerlink" title="Top10 不足的日志记录和监控"></a>Top10 不足的日志记录和监控</h2><p><strong>不足的日志记录和监控，以及事件响应缺失或无效的集成，使攻击者能够进一步攻击系统、保持持续性或转向更多系统，以及篡改、提取或销毁数据。如：未对登录、登录失败和高额交易等记录可审计性事件进行记录；告警和错误事件未能产生或产生不完整的日志信息。</strong></p><h3 id="防御："><a href="#防御：" class="headerlink" title="防御："></a>防御：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">确保所有登录、访问控制失败、输入验证失败能够被记录到日志中去，并保留足够的用户上下文信息，以识别可疑或恶意帐户，并为后期取证预留足够时间。</span><br><span class="line"></span><br><span class="line">建立有效的检测和告警机制，使可疑的活动在可接受的时间内被发现并应对。</span><br><span class="line"></span><br><span class="line">建立或采取一个应急响应机制和恢复计划。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OWASP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTrack Website Copie</title>
      <link href="/2019/02/28/HTTrack%20Website%20Copie/"/>
      <url>/2019/02/28/HTTrack%20Website%20Copie/</url>
      
        <content type="html"><![CDATA[<p><strong>HTTrack 是一款既免费又实用的工具，它能创建和目标网站一样的离线脱机副本。内容包括原始网站的所有网页、链接、图片等。作用是为了减少与目标系统交互,避免触发目标系统的报警机制。</strong></p><a id="more"></a><h2 id="HTTrack-安装"><a href="#HTTrack-安装" class="headerlink" title="HTTrack 安装"></a>HTTrack 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install webhttrack</span><br></pre></td></tr></table></figure><p><code>Kali Linux</code> 自己带。</p><h2 id="HTTrack-使用"><a href="#HTTrack-使用" class="headerlink" title="HTTrack 使用"></a>HTTrack 使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httrack</span><br></pre></td></tr></table></figure><p><img src="https://snasec.oss-cn-beijing.aliyuncs.com/typecho/2019/02/28/57776425450447/20181231115001949_1703371291.png" alt="20181231115001949_1703371291.png"></p><p><img src="https://snasec.oss-cn-beijing.aliyuncs.com/typecho/2019/02/28/578982495873758/20181231115058358_1130023483.png" alt="20181231115058358_1130023483.png"></p>]]></content>
      
      
      <categories>
          
          <category> 工具分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> HTTrack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web应用程序渗透测试思路</title>
      <link href="/2019/02/24/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%80%9D%E8%B7%AF/"/>
      <url>/2019/02/24/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%80%9D%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="一般规范"><a href="#一般规范" class="headerlink" title="一般规范"></a>一般规范</h2><p><strong>一些字符在HTTP请求的不同位置具有不同含义。当修改请求中的数据时，应该对这些字符进行URL编码，以确保应用程序按照想要的方式解释这些字符。</strong></p><a id="more"></a><blockquote><p>&amp;用分割URL查询字符串与消息主体中的参数，要插入字面量&amp;字符，必须将其转换成URL编码 <strong>%26</strong>。</p></blockquote><blockquote><p>=用于分割URL查询字符串与消息主体中每个参数的名称与值，所以要插入字面量=字符时要URL编码<strong>%3d</strong>。</p></blockquote><blockquote><p>?用于标记URL查询字符串的起始位置。要插入字面量需要URL编码<strong>%3f</strong>。</p></blockquote><blockquote><p>空格用于在请求的第一行中标记URL的结束位置，并可用于Cookie消息头中表示一个cookie值结束。要插入一个字面两空格字符必须将其转换成<strong>%20</strong>或+。</p></blockquote><blockquote><p>因为+表示一个编码的空格，要插入一个字面量+字符，需编码为<strong>%2b</strong>。</p></blockquote><blockquote><p>；用于在Cookie消息头中分隔单个Cookie。要插入字面量+字符，必须将其编码为%3b。</p></blockquote><blockquote><p>#用于在URL中标记片段标识符。如果在浏览器的URL中输入这个字符，他将会传送给服务器的URL截短。要插入需将其编码为%23。</p></blockquote><blockquote><p>%在URL编码方案中作为前缀。要插入字面量%字符，必须将其编码为%25。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此外要注意的是，在表单中输入URL编码的数据通常会导致浏览器执行另一层编码。例如在表单中提交%00可能会导致想服务器发送值%2500。为此，通常最好是在拦截代理服务器中查看最终请求。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">许多查找常见Web应用程序的测试需要发送各种专门设计的输入字符串，并监控应用程序的响应，从中搜索表示漏洞存在的反常现象。有时，无论是否提交某个特定漏洞的触发器，应用程序对一个特殊请求的响应都将包含这个漏洞的签名。只要提交专门设计的特殊输入导致了与某个漏洞有关的行为（如一个特殊的错误消息），就应该重新核查，确定在相关参数中提交良性输入是否也会造成相同的行为。如果两种输入的行为相同，那么最初的发现可能是一个错误警报。</span><br></pre></td></tr></table></figure><h2 id="解析应用程序内容"><a href="#解析应用程序内容" class="headerlink" title="解析应用程序内容"></a>解析应用程序内容</h2><h3 id="搜索可见的"><a href="#搜索可见的" class="headerlink" title="搜索可见的"></a>搜索可见的</h3><ol><li><p>配置浏览器，使用首先集成代理/抓取工具。可以使用Burp监控和解析有代理服务器处理的Web内容。</p></li><li><p>配置浏览器，监控和分析被浏览器处理的HTTP和HTML内容。</p></li><li><p>以常规的方法应用程序，访问发现的每个链接URL,提交每一个表单并执行全部多阶段功能。尝试激活与禁用JS,激活与禁用Cookie的情况下浏览。</p></li><li><p>如果应用程序使用身份验证，并且渗透测试人员拥有帐号，或可以注册帐号，那么就可以使用该帐号访问受保护的内容。</p></li><li><p>当浏览，监控通过拦截代理服务器的请求与响应时，了解被提交的数据种类，了解客户端是如何控制服务器端的应用程序的行为。</p></li><li><p>检查被动抓取生成的站点地图，确定任何尚未使用浏览器访问到的内容或功能。</p></li><li><p>完成手动浏览和被动抓取后，可以用一组发现的URL作为种子，使用爬虫抓取应用程序。有时候可以发现手动浏览时尚未发现的内容。</p></li></ol><h3 id="浏览公共资源"><a href="#浏览公共资源" class="headerlink" title="浏览公共资源"></a>浏览公共资源</h3><ol><li><p>使用因特网搜索引擎和历史档案。</p></li><li><p>使用高级搜索语法提高搜索效率。</p></li><li><p>搜索在应用程序内容中发现的任何姓名和电子邮箱地址等。包括新闻和分组搜索等。</p></li><li><p>检查任意已发布的WSDL文件（ WebServices Description Language (WSDL Web服务语言)是一个用于精确描述Web Service的文档格式。），以生成应用程序可能采用的功能名称和参数值列表。</p></li></ol><h3 id="发现隐藏的内容"><a href="#发现隐藏的内容" class="headerlink" title="发现隐藏的内容"></a>发现隐藏的内容</h3><ol><li><p>确定应用程序如何处理访问不存在的资源的请求。手动提交一些请求，访问已知有效和无效的资源，比较对这些请求的响应。找到一种确定资源并不存在的方法。</p></li><li><p>获取常见文件与目录名以及常见的文件扩展名列表。根据这些内容设法推断出其他内容，假如有a.php，c.php 那可以推断出有c.php。</p></li><li><p>审查所有客户端代码，确定任何与服务器端内容（包括HTML注释和禁用的表单元素）有关线索。</p></li><li><p>使用自动化技巧，根据目录名，文件名，文件扩展名列表提出大量请求，监控应用程序的相应。</p></li></ol><h3 id="查找默认的内容"><a href="#查找默认的内容" class="headerlink" title="查找默认的内容"></a>查找默认的内容</h3><ol><li><p>探查所有默认或已知存在的内容，使用NIKTO的选项提高探查的效率。</p></li><li><p>手动核查所有可能有用的发现，减少探查结果中的错误警报。</p></li></ol><h3 id="枚举标识符指定的功能"><a href="#枚举标识符指定的功能" class="headerlink" title="枚举标识符指定的功能"></a>枚举标识符指定的功能</h3><p>确定任何通过在请求参数中提交一个功能标识符访问特殊应用程序功能的情况。（如 admin.jsp/login.php）</p><h3 id="调试参数"><a href="#调试参数" class="headerlink" title="调试参数"></a>调试参数</h3><ol><li><p>选择一个或几个使用隐藏调试参数（如debug=true）的应用程序或页面或功能，他们最有可能出现在，登录，搜索，文件上传下载等功能上。</p></li><li><p>使用常用调试参数名（debug、test、hide、source）与常用参数值（true、yes、on、1）列表，排出键值对组合，可使用Burp。</p></li><li><p>在应用程序的响应中查找任何表示添加的参数对应用程序的行为造成影响的反常现象。</p></li></ol><h2 id="分析应用程序"><a href="#分析应用程序" class="headerlink" title="分析应用程序"></a>分析应用程序</h2><h3 id="确定功能"><a href="#确定功能" class="headerlink" title="确定功能"></a>确定功能</h3><ol><li><p>确定为使应用程序正常运行而建立的核心功能以及每项功能旨在执行的操作。</p></li><li><p>确定应用程序采用的核心安全机制以及他们的工作机制。如了解处理身份验证、会话管理、与访问控制的关键机制以及支持他们的功能、如用户注册和账户恢复。</p></li><li><p>确定所有外围功能和行为，如重定向，站外链接，错误消息，管理与日志功能。</p></li></ol><h3 id="确定数据进入点"><a href="#确定数据进入点" class="headerlink" title="确定数据进入点"></a>确定数据进入点</h3><ol><li><p>确定在应用程序中引入用户输入的所有进入点，URL、查询字符串参数、POST数据、cookie与其他应用程序处理的HTTP消息头。</p></li><li><p>分析应用程序使用的所有定制数据传输或编码机制，如非常规的查询字符串格式。</p></li><li><p>去定所有应用程序中引入用户控制或其他第三方数据的外带通道，如处理显示SMTP收到的消息的Web邮件应用。</p></li></ol><h3 id="确定所使用的技术"><a href="#确定所使用的技术" class="headerlink" title="确定所使用的技术"></a>确定所使用的技术</h3><ol><li><p>确定，如果表单、脚本、Cookie、控件等不同技术。</p></li><li><p>尽可能确定服务器端使用的技术，包括脚本语言、应用程序平台、数据库、邮件系统等。</p></li><li><p>网站指纹识别。</p></li></ol><h3 id="解析受攻击面"><a href="#解析受攻击面" class="headerlink" title="解析受攻击面"></a>解析受攻击面</h3><ol><li><p>设法去定服务器端应用程序的内部结果与功能以及用于实现客户端可见行为的后台机制。</p></li><li><p>确定各种与每一项功能有关的常见漏洞。</p></li><li><p>定制攻击计划，优先考虑最有用的功能以及与它有关的最严重的潜在漏洞。</p></li></ol><h2 id="测试客户端控件"><a href="#测试客户端控件" class="headerlink" title="测试客户端控件"></a>测试客户端控件</h2><h3 id="通过客户端传送数据"><a href="#通过客户端传送数据" class="headerlink" title="通过客户端传送数据"></a>通过客户端传送数据</h3><ol><li><p>在应用程序中，确定隐藏的表单字段、cookie和URL参数明显用于通过客户端传送数据的所有情况。</p></li><li><p>检查逻辑错误</p></li></ol><h2 id="测试验证机制"><a href="#测试验证机制" class="headerlink" title="测试验证机制"></a>测试验证机制</h2><p><img src="_v_images/20190104162829209_242673519.png" alt=""></p><h3 id="了解验证机制"><a href="#了解验证机制" class="headerlink" title="了解验证机制"></a>了解验证机制</h3><ol><li><p>确定应用程序使用的验证技术。</p></li><li><p>确定所有与验证有关的功能。</p></li><li><p>如果应用程序为采用自动自我注册机制，确定是否可以使用任何其他地方获得几个用户账户。</p></li></ol><h3 id="测试密码强度"><a href="#测试密码强度" class="headerlink" title="测试密码强度"></a>测试密码强度</h3><ol><li><p>在应用程序中查找有关用户密码最小强度规则的说明。</p></li><li><p>尝试使用所有自我注册或密码修改功能，设定各种脆弱密码，确定应用程序实际应用的密码强度尝试。</p></li><li><p>测试不完整的证书确认。</p></li><li><p>爆破。</p></li></ol><h3 id="测试用户名枚举"><a href="#测试用户名枚举" class="headerlink" title="测试用户名枚举"></a>测试用户名枚举</h3><p>可使用Burp批量跑，然后查看返回的结果对比不同。</p><h3 id="测试密码猜测的适应性"><a href="#测试密码猜测的适应性" class="headerlink" title="测试密码猜测的适应性"></a>测试密码猜测的适应性</h3><p>使用有效用户名和无效用户的请求。监控应用程序的响应，确定他们之间的所有差异。如果测试多次失败还没返回任何锁定账户的消息，再提交一个正确的包含有效证书的请求。如果这个请求成功，那说明应用程序没采用任何账户锁定策略。</p><p>这个时候就可以批量跑爆破了。</p><h3 id="测试账户恢复功能"><a href="#测试账户恢复功能" class="headerlink" title="测试账户恢复功能"></a>测试账户恢复功能</h3><ol><li><p>查看是否有忘记密码功能</p></li><li><p>使用一个帐号完成账户恢复的功能，了解运作机制。</p></li><li><p>查看是否有密保机制，并且尝试找出容易猜测出答案的问题。</p></li><li><p>查看是否有暗示功能。如果有尝试上面。</p></li><li><p>是否为发送邮件完成帐号恢复，确定是否控制邮件。</p></li></ol><h3 id="测试“记住我”功能"><a href="#测试“记住我”功能" class="headerlink" title="测试“记住我”功能"></a>测试“记住我”功能</h3><ol><li><p>如果有记住我功能，激活并分析他的作用，并且仔细查找可能存在的漏洞。</p></li><li><p>检查记住我功能设定的所有持久性cookie。寻找任何明确表示出用户身份或明显包含可预测的用户标识符的数据。</p></li><li><p>即使其中保存的数据经过严密编码或模糊处理，也要仔细分析这些数据，并比较“记住”几个非常类似的用户名和密码的结果，找到逆向的机会。</p></li><li><p>根据上面的结果，适当修改cookie，尝试登录。</p></li></ol><h3 id="测试伪装功能"><a href="#测试伪装功能" class="headerlink" title="测试伪装功能"></a>测试伪装功能</h3><ol><li><p>如果应用包含任何明确的功能，允许伪装成另一名用户，那么仔细审查，查找是否越权漏洞存在。</p></li><li><p>尝试伪装成管理。</p></li></ol><h3 id="尝试用户名唯一性"><a href="#尝试用户名唯一性" class="headerlink" title="尝试用户名唯一性"></a>尝试用户名唯一性</h3><ol><li><p>尝试用不同的密码注册相同的账户</p></li><li><p>如果被阻止，就可以枚举出注册用户名</p></li><li><p>如果可以注册多个相同账户，分析这个情况，尝试修改一个用户名的密码，使其与另外一个相同，然后登录。</p></li></ol><h3 id="测试证书的可预测性"><a href="#测试证书的可预测性" class="headerlink" title="测试证书的可预测性"></a>测试证书的可预测性</h3><ol><li><p>如果用户名或密码有应用程序自动生成，设法获得几个相连的用户名或密码。确定任何可探测顺序或模式。</p></li><li><p>如果生成的用户名可预测，那么就可以推断出有效的用户名。</p></li></ol><h3 id="检测不安全的证书传输"><a href="#检测不安全的证书传输" class="headerlink" title="检测不安全的证书传输"></a>检测不安全的证书传输</h3><ol><li><p>遍历所有需要传输证书，与验证有关的功能，登录、注册、密码修改等等。拦截查看所有流量。</p></li><li><p>查看是否加密传输。</p></li><li><p>查看证书是否保存在cookie中，有可能导致XSS攻击</p></li><li><p>是否为HTTPS加载登录表单，如果不是，那么可能会遭受到中间人攻击。</p></li></ol><h3 id="测试不安全的证书分配"><a href="#测试不安全的证书分配" class="headerlink" title="测试不安全的证书分配"></a>测试不安全的证书分配</h3><ol><li><p>确定应用程序如何想新用户分配证书。常用的方法如电子邮件等。</p></li><li><p>如果应用程序分配账户激活URL，尝试注册几个紧密相连的新账户，并确定收到的URL中的顺序。如果有规律，尝试预测后续或最近的用户的URL，尝试占有他们的账户。</p></li><li><p>尝试多次重复使用同一个URL，看看应用程序是允许这么做。确定这种方式是否可以给一个已经激活的账户设定一个新密码。</p></li></ol><h3 id="测试不安全的存储"><a href="#测试不安全的存储" class="headerlink" title="测试不安全的存储"></a>测试不安全的存储</h3><ol><li><p>如果可以访问散列密码，应检查共享同一个散列密码值的账户。尝试以采用最常用的散列值的密码登录。</p></li><li><p>使用相关散列算法或彩虹表查找明文值。</p></li></ol><h3 id="测试逻辑缺陷"><a href="#测试逻辑缺陷" class="headerlink" title="测试逻辑缺陷"></a>测试逻辑缺陷</h3><h4 id="1-测试故障开放条件"><a href="#1-测试故障开放条件" class="headerlink" title="1.测试故障开放条件"></a>1.测试故障开放条件</h4><ol><li><p>对于要求应用程序检查用户证书的每一项功能（包括登录与密码修改功能），使用受控制的账户以正常方式访问这些功能。注意它们提交给应用程序的每一项请求参数。</p></li><li><p>连续多次重复以上过程，以各种无法预料的方式轮流修改每一项参数，破坏应用程序的逻辑，对每一个参数进行以下修改。</p><blockquote><p>提交一个空字符串值。</p><p>完全删除名/值对。</p><p>提交非常长和非常短的值。</p><p>提交字符串代替数字或提交数字代替字符串。</p><p>以相同和不同的值，多次提交同一个命名参数。</p></blockquote></li><li><p>检查上述的请求的响应，如果出现任何无法预料的差异，对这个结果进行进一步测试。</p></li></ol><h4 id="2-测试多阶段处理机制"><a href="#2-测试多阶段处理机制" class="headerlink" title="2.测试多阶段处理机制"></a>2.测试多阶段处理机制</h4><ol><li><p>如果任何与验证有关的功能需要在一系列不同的请求中提交证书，确定每个阶段的主要目的，同时注意每个阶段提交的参数。</p></li><li><p>多次重复上述步骤，修改提交请求的顺序，破坏应用程序的逻辑。相关测试包括：</p><blockquote><p>以不同顺序完成所有阶段，到达想要的那个阶段。</p><p>轮流直接进入每一个阶段，然后按正常顺序访问后续步骤。</p><p>几次访问上述功能，轮流省略每一个阶段，然后在后一个阶段继续按正常的顺序访问。</p><p>根据观察到的结果及每个功能阶段的主要目的，尝试通过其他方式修改访问这些阶段的顺序，并访问开发者没有预料到的阶段。</p></blockquote></li><li><p>做开发者没想到的事。</p></li></ol><h3 id="利用漏洞获取为授权访问"><a href="#利用漏洞获取为授权访问" class="headerlink" title="利用漏洞获取为授权访问"></a>利用漏洞获取为授权访问</h3><ol><li>尝试以另一名用户的身份进行验证，最好是管理员</li><li>爆破时要考虑密码强度规则以及密码确认机制的完整性，避免浪费。</li><li>可使用Burp搞定。</li></ol><h4 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h4><p>来自 《黑客攻防技术宝典-Web实战篇(The Web Application Hacker’s Handbook Version2)》</p>]]></content>
      
      
      <categories>
          
          <category> 读书分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 规范 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kunpeng</title>
      <link href="/2019/02/17/Kunpeng/"/>
      <url>/2019/02/17/Kunpeng/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Kunpeng是一个Golang编写的开源POC检测框架，集成了包括数据库、中间件、web组件、cms等等的漏洞POC，可检测弱口令、SQL注入、XSS、RCE等漏洞类型，以动态链接库的形式提供调用，通过此项目可快速对目标进行安全漏洞检测，比攻击者快一步发现风险漏洞。</p><a id="more"></a><p>这不是一个POC框架轮子，而是为了解决轮子问题而设计的，也不仅仅只是框架，定位是期望成为一个大家共同维护的漏洞POC库，安全开发人员只需专注于相关安全检测系统的业务逻辑代码实现，而不必各自重复的耗费精力维护漏洞库。</p><p>运行环境：Windows，Linux，Darwin<br>工作形态：动态链接库，so、dll、go plugin</p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li>开箱即用，无需安装任何依赖</li><li>跨语言使用，动态链接库形式提供调用</li><li>单文件，更新方便，直接覆盖即可</li><li>开源社区维护，内置常见漏洞POC</li><li>最小化漏洞验证和理论验证，尽量避免攻击行为</li></ul><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>渗透测试辅助工具：例如msf，交互控制台 -&gt; Kunpeng</p><p>网络资产安全监控：例如巡风，端口扫描 -&gt; 指纹识别 -&gt; kunpeng 或 nmap -&gt; kunpeng</p><p>扫描器： 作为扫描器的漏洞库</p><p>更多使用场景可自由发挥</p><p>详细： <a href="https://github.com/opensec-cn/kunpeng" target="_blank" rel="noopener">https://github.com/opensec-cn/kunpeng</a></p><p>感谢大佬的无私分享</p>]]></content>
      
      
      <categories>
          
          <category> 工具分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Windows </tag>
            
            <tag> POC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fail2ban 阻止SSH爆破</title>
      <link href="/2019/01/22/Fail2ban%20%E9%98%BB%E6%AD%A2SSH%E7%88%86%E7%A0%B4/"/>
      <url>/2019/01/22/Fail2ban%20%E9%98%BB%E6%AD%A2SSH%E7%88%86%E7%A0%B4/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Fail2ban可以监视你的系统日志，匹配日志的错误信息执行相应的屏蔽动作。</p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line"></span><br><span class="line">yum -y install fail2ban</span><br></pre></td></tr></table></figure><h2 id="配置规则"><a href="#配置规则" class="headerlink" title="配置规则"></a>配置规则</h2><p>Fail2ban配置文件在 <code>/etc/fail2ban</code></p><p><code>jail.conf</code>防御配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;fail2ban&#x2F;jail.local[DEFAULT]</span><br><span class="line">ignoreip &#x3D; 127.0.0.1&#x2F;8        #IP白名单，白名单中的IP不会屏蔽，可以用（,）分隔填写多个ip</span><br><span class="line">bantime  &#x3D; 86400              #屏蔽时间-秒</span><br><span class="line">findtime &#x3D; 600                #设置多长时间（秒）内超过 maxretry 限制次数即被封锁</span><br><span class="line">maxretry &#x3D; 3                  #最大尝试次数</span><br><span class="line"></span><br><span class="line">#这里banaction需要firewallcmd-ipset</span><br><span class="line">banaction &#x3D; firewallcmd-ipset #屏蔽IP所使用的方法，firewalld，iptables</span><br><span class="line"></span><br><span class="line">action &#x3D; %(action_mwl)s       #动作参数</span><br><span class="line"></span><br><span class="line">[sshd]</span><br><span class="line">enabled &#x3D; true                # 开启防护，false关闭</span><br><span class="line">filter  &#x3D; sshd                #过滤规则名称，对应 filter.d 目录下的 sshd.conf</span><br><span class="line">port    &#x3D; 22                  #对应的端口</span><br><span class="line">action &#x3D; %(action_mwl)s       #动作参数</span><br><span class="line">logpath &#x3D; &#x2F;var&#x2F;log&#x2F;secure     #监控的日志路径</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><code>systemctl start fail2ban</code>启动<code>Fail2ban</code></p><p>同一个IP，在10分钟内，如果连续超过3次错误，则使用Firewalld Ban掉该IP。</p><p>输入：<code>fail2ban-client status sshd</code> 查看被Ban掉的IP。</p>]]></content>
      
      
      <categories>
          
          <category> 工具分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Fail2ban </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Typecho在Apache环境下开启伪静态</title>
      <link href="/2018/12/27/Typecho%E5%9C%A8Apache%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%80%E5%90%AF%E4%BC%AA%E9%9D%99%E6%80%81/"/>
      <url>/2018/12/27/Typecho%E5%9C%A8Apache%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%80%E5%90%AF%E4%BC%AA%E9%9D%99%E6%80%81/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">本文环境:</span><br><span class="line">CentOS7.3</span><br><span class="line">Apache 2.4.6</span><br><span class="line">PHP 5.4.16</span><br><span class="line">网站存放位置: &#x2F;var&#x2F;www&#x2F;html</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="1、修改Apache的rewrite模块"><a href="#1、修改Apache的rewrite模块" class="headerlink" title="1、修改Apache的rewrite模块"></a>1、修改Apache的rewrite模块</h2><p><code>vi /etc/httpd/conf/httpd.conf</code></p><p>找到httpd.conf中是否包含<code>LoadModule rewrite_module modules/mod_rewrite.so</code>如果没有就自己加一个</p><p>增加配置如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory &quot;&#x2F;var&#x2F;www&#x2F;html&quot;&gt; </span><br><span class="line">    Order allow,deny</span><br><span class="line">    Allow from all</span><br><span class="line">    AllowOverride All</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br></pre></td></tr></table></figure><h2 id="2、修改-htaccess文件"><a href="#2、修改-htaccess文件" class="headerlink" title="2、修改.htaccess文件"></a>2、修改.htaccess文件</h2><p>路径：/var/www/html/.htaccess，如果没有就新建一个将以下内容添加进去。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">    RewriteEngine On</span><br><span class="line">    RewriteBase &#x2F;</span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">    RewriteRule ^(.*)$ index.php [E&#x3D;PATH_INFO:$1] </span><br><span class="line">&lt;&#x2F;IfModule&gt;</span><br></pre></td></tr></table></figure><p><strong>重启apache</strong></p><h2 id="3、开启网站地址重写功能"><a href="#3、开启网站地址重写功能" class="headerlink" title="3、开启网站地址重写功能"></a>3、开启网站地址重写功能</h2><p><img src="https://www.snasec.com/usr/uploads/2019/02/270287826.png" alt="地址重写功能.png"></p><p>如果提示“重写功能检测失败, 请检查你的服务器设置” 勾上继续就行</p>]]></content>
      
      
      <categories>
          
          <category> 分享经验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Apache </tag>
            
            <tag> Typecho </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NetEase-MusicBox</title>
      <link href="/2018/12/26/NetEase-MusicBox/"/>
      <url>/2018/12/26/NetEase-MusicBox/</url>
      
        <content type="html"><![CDATA[<h2 id="基于Python编写的-高品质网易云音乐命令行版本"><a href="#基于Python编写的-高品质网易云音乐命令行版本" class="headerlink" title="基于Python编写的 高品质网易云音乐命令行版本"></a>基于Python编写的 高品质网易云音乐命令行版本</h2><a id="more"></a><p><img src="https://camo.githubusercontent.com/a2cdeab17a7ea0218ec84b25c1026d8bf5483f29/68747470733a2f2f7166696c652e616f626565662e636e2f33616262613362386133393934656533643563642e676966" alt="示范.gif"></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Ubuntu-Debian"><a href="#Ubuntu-Debian" class="headerlink" title="Ubuntu/Debian"></a>Ubuntu/Debian</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ (sudo) pip install NetEase-MusicBox</span><br><span class="line"></span><br><span class="line">$ (sudo) apt-get install mpg123</span><br></pre></td></tr></table></figure><h2 id="可选依赖"><a href="#可选依赖" class="headerlink" title="可选依赖"></a>可选依赖</h2><p><code>aria2</code> 用于缓存歌曲<br><code>libnotify-bin</code> 用于支持消息提示（Linux平台）<br><code>pyqt python-dbus dbus qt</code> 用于支持桌面歌词 </p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ musicbox</span><br></pre></td></tr></table></figure><p><em>参考来源：<a href="https://github.com/darknessomi/musicbox" target="_blank" rel="noopener">musicbox</a></em></p>]]></content>
      
      
      <categories>
          
          <category> 工具分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 终端 </tag>
            
            <tag> 音乐 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
